<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Transaction | Asahina Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/ok_favicon.ico">
    <meta name="description" content="For Tech Blog">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.167a03c8.css" as="style"><link rel="preload" href="/assets/js/app.7bf124e2.js" as="script"><link rel="preload" href="/assets/js/3.11415aa8.js" as="script"><link rel="preload" href="/assets/js/1.f9d84a83.js" as="script"><link rel="preload" href="/assets/js/126.10227c11.js" as="script"><link rel="prefetch" href="/assets/js/10.160e6e9c.js"><link rel="prefetch" href="/assets/js/100.3cdef464.js"><link rel="prefetch" href="/assets/js/101.5178591b.js"><link rel="prefetch" href="/assets/js/102.336b2e64.js"><link rel="prefetch" href="/assets/js/103.b749e8f0.js"><link rel="prefetch" href="/assets/js/104.4e0be82d.js"><link rel="prefetch" href="/assets/js/105.2283e32d.js"><link rel="prefetch" href="/assets/js/106.f6d10c35.js"><link rel="prefetch" href="/assets/js/107.168e6177.js"><link rel="prefetch" href="/assets/js/108.8668c986.js"><link rel="prefetch" href="/assets/js/109.6971a03e.js"><link rel="prefetch" href="/assets/js/11.286216e9.js"><link rel="prefetch" href="/assets/js/110.eae35184.js"><link rel="prefetch" href="/assets/js/111.05a11607.js"><link rel="prefetch" href="/assets/js/112.3e67db1b.js"><link rel="prefetch" href="/assets/js/113.89cb826b.js"><link rel="prefetch" href="/assets/js/114.f3d7a768.js"><link rel="prefetch" href="/assets/js/115.63beb6b3.js"><link rel="prefetch" href="/assets/js/116.d3f81a36.js"><link rel="prefetch" href="/assets/js/117.b85ad082.js"><link rel="prefetch" href="/assets/js/118.f1a51aea.js"><link rel="prefetch" href="/assets/js/119.19e0a7b9.js"><link rel="prefetch" href="/assets/js/12.e7c5cbfb.js"><link rel="prefetch" href="/assets/js/120.86fd078a.js"><link rel="prefetch" href="/assets/js/121.007d2594.js"><link rel="prefetch" href="/assets/js/122.f22031f8.js"><link rel="prefetch" href="/assets/js/123.84ca6b69.js"><link rel="prefetch" href="/assets/js/124.3fbddabe.js"><link rel="prefetch" href="/assets/js/125.db4ff77b.js"><link rel="prefetch" href="/assets/js/127.0d7b5084.js"><link rel="prefetch" href="/assets/js/128.1acf472b.js"><link rel="prefetch" href="/assets/js/129.825fe808.js"><link rel="prefetch" href="/assets/js/13.43cc31b1.js"><link rel="prefetch" href="/assets/js/130.0bfc98b2.js"><link rel="prefetch" href="/assets/js/131.aede149c.js"><link rel="prefetch" href="/assets/js/132.85593e8b.js"><link rel="prefetch" href="/assets/js/133.0f271fc3.js"><link rel="prefetch" href="/assets/js/14.0dd24f84.js"><link rel="prefetch" href="/assets/js/15.1b41732d.js"><link rel="prefetch" href="/assets/js/16.183ffc75.js"><link rel="prefetch" href="/assets/js/17.ad9af643.js"><link rel="prefetch" href="/assets/js/18.c13df2c1.js"><link rel="prefetch" href="/assets/js/19.2203e54d.js"><link rel="prefetch" href="/assets/js/20.34db0668.js"><link rel="prefetch" href="/assets/js/21.44a33107.js"><link rel="prefetch" href="/assets/js/22.52d283c5.js"><link rel="prefetch" href="/assets/js/23.4e0524b7.js"><link rel="prefetch" href="/assets/js/24.decf705e.js"><link rel="prefetch" href="/assets/js/25.6873ed81.js"><link rel="prefetch" href="/assets/js/26.4d86aa15.js"><link rel="prefetch" href="/assets/js/27.6b45c11e.js"><link rel="prefetch" href="/assets/js/28.f4d58a14.js"><link rel="prefetch" href="/assets/js/29.871a72fd.js"><link rel="prefetch" href="/assets/js/30.49b4c5ea.js"><link rel="prefetch" href="/assets/js/31.cfc2945d.js"><link rel="prefetch" href="/assets/js/32.343850cd.js"><link rel="prefetch" href="/assets/js/33.0517526c.js"><link rel="prefetch" href="/assets/js/34.85ea8eb4.js"><link rel="prefetch" href="/assets/js/35.43969a65.js"><link rel="prefetch" href="/assets/js/36.7836aa64.js"><link rel="prefetch" href="/assets/js/37.e5812400.js"><link rel="prefetch" href="/assets/js/38.d8d214a6.js"><link rel="prefetch" href="/assets/js/39.f1cb3672.js"><link rel="prefetch" href="/assets/js/4.64515438.js"><link rel="prefetch" href="/assets/js/40.7adf5ab8.js"><link rel="prefetch" href="/assets/js/41.57755578.js"><link rel="prefetch" href="/assets/js/42.38ebc979.js"><link rel="prefetch" href="/assets/js/43.ca6a6476.js"><link rel="prefetch" href="/assets/js/44.41942e77.js"><link rel="prefetch" href="/assets/js/45.41cc929c.js"><link rel="prefetch" href="/assets/js/46.4cbb486f.js"><link rel="prefetch" href="/assets/js/47.ee2cc207.js"><link rel="prefetch" href="/assets/js/48.4397b1ca.js"><link rel="prefetch" href="/assets/js/49.d9aa00a5.js"><link rel="prefetch" href="/assets/js/5.a9ee7173.js"><link rel="prefetch" href="/assets/js/50.b45ed76a.js"><link rel="prefetch" href="/assets/js/51.919d0154.js"><link rel="prefetch" href="/assets/js/52.eb85632f.js"><link rel="prefetch" href="/assets/js/53.3a47197f.js"><link rel="prefetch" href="/assets/js/54.c8d2aed8.js"><link rel="prefetch" href="/assets/js/55.b8b65327.js"><link rel="prefetch" href="/assets/js/56.2d8e9a6e.js"><link rel="prefetch" href="/assets/js/57.38ba175c.js"><link rel="prefetch" href="/assets/js/58.2f7ff696.js"><link rel="prefetch" href="/assets/js/59.56eb125d.js"><link rel="prefetch" href="/assets/js/6.3a661d6d.js"><link rel="prefetch" href="/assets/js/60.197980b0.js"><link rel="prefetch" href="/assets/js/61.4b544728.js"><link rel="prefetch" href="/assets/js/62.b2382e0f.js"><link rel="prefetch" href="/assets/js/63.733bd9cd.js"><link rel="prefetch" href="/assets/js/64.d59be5ac.js"><link rel="prefetch" href="/assets/js/65.9db92d49.js"><link rel="prefetch" href="/assets/js/66.b89a7790.js"><link rel="prefetch" href="/assets/js/67.1353b5b4.js"><link rel="prefetch" href="/assets/js/68.6cf3768b.js"><link rel="prefetch" href="/assets/js/69.5590fae6.js"><link rel="prefetch" href="/assets/js/7.9cb840c5.js"><link rel="prefetch" href="/assets/js/70.2ded2061.js"><link rel="prefetch" href="/assets/js/71.5a572a0a.js"><link rel="prefetch" href="/assets/js/72.4894d369.js"><link rel="prefetch" href="/assets/js/73.c3a7815f.js"><link rel="prefetch" href="/assets/js/74.d1adf6f2.js"><link rel="prefetch" href="/assets/js/75.7e41458b.js"><link rel="prefetch" href="/assets/js/76.686c4022.js"><link rel="prefetch" href="/assets/js/77.835ea7c3.js"><link rel="prefetch" href="/assets/js/78.9ffc54ca.js"><link rel="prefetch" href="/assets/js/79.b6aa2776.js"><link rel="prefetch" href="/assets/js/8.a1c97708.js"><link rel="prefetch" href="/assets/js/80.97d7ee23.js"><link rel="prefetch" href="/assets/js/81.a0a3a3ee.js"><link rel="prefetch" href="/assets/js/82.2290dd53.js"><link rel="prefetch" href="/assets/js/83.0927cd8c.js"><link rel="prefetch" href="/assets/js/84.4d42c930.js"><link rel="prefetch" href="/assets/js/85.f344b6f7.js"><link rel="prefetch" href="/assets/js/86.f7bb8b2b.js"><link rel="prefetch" href="/assets/js/87.7df4d88d.js"><link rel="prefetch" href="/assets/js/88.2b2debf8.js"><link rel="prefetch" href="/assets/js/89.042c73d8.js"><link rel="prefetch" href="/assets/js/9.402194bf.js"><link rel="prefetch" href="/assets/js/90.4d7b430c.js"><link rel="prefetch" href="/assets/js/91.f65d4f6e.js"><link rel="prefetch" href="/assets/js/92.89ac564f.js"><link rel="prefetch" href="/assets/js/93.160f3887.js"><link rel="prefetch" href="/assets/js/94.29ed14c3.js"><link rel="prefetch" href="/assets/js/95.4afaed8c.js"><link rel="prefetch" href="/assets/js/96.e8ef314f.js"><link rel="prefetch" href="/assets/js/97.e8db3b68.js"><link rel="prefetch" href="/assets/js/98.540f1fa5.js"><link rel="prefetch" href="/assets/js/99.3a27d21e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.167a03c8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Asahina Blog</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>For Tech Blog</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>Kincolle</span>
            
          <span data-v-25ba6db2>2020 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="Asahina Blog" class="logo"> <span class="site-name">Asahina Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/Design Pattern/" class="nav-link"><i class="undefined"></i>
  Design Pattern
</a></li><li class="dropdown-item"><!----> <a href="/categories/Elasticsearch/" class="nav-link"><i class="undefined"></i>
  Elasticsearch
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hive/" class="nav-link"><i class="undefined"></i>
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Lucene/" class="nav-link"><i class="undefined"></i>
  Lucene
</a></li><li class="dropdown-item"><!----> <a href="/categories/Mybatis/" class="nav-link"><i class="undefined"></i>
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Redis/" class="nav-link"><i class="undefined"></i>
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/kincolle" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  My Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-39576ba9> <h3 class="name" data-v-39576ba9>
    Kincolle
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>123</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>13</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/Design Pattern/" class="nav-link"><i class="undefined"></i>
  Design Pattern
</a></li><li class="dropdown-item"><!----> <a href="/categories/Elasticsearch/" class="nav-link"><i class="undefined"></i>
  Elasticsearch
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hive/" class="nav-link"><i class="undefined"></i>
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Lucene/" class="nav-link"><i class="undefined"></i>
  Lucene
</a></li><li class="dropdown-item"><!----> <a href="/categories/Mybatis/" class="nav-link"><i class="undefined"></i>
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Redis/" class="nav-link"><i class="undefined"></i>
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/kincolle" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  My Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Transaction</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>Kincolle</span>
            
          <span data-v-25ba6db2>2020 - </span>
          2022
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">Transaction</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>Kincolle</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>8/16/2018</span></i> <!----> <i class="tags iconfont reco-tag" data-v-f875f3fc><span class="tag-item" data-v-f875f3fc>Spring Framework</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="transaction"><a href="#transaction" class="header-anchor">#</a> Transaction</h2> <p>In computer science, ACID (Atomicity, Consistency, Isolation, Durability) is a set of properties of database transactions intended to guarantee validity even in the event of errors, power failures, etc.</p> <ul><li>Atomicity</li></ul> <blockquote><p>Transactions are often composed of multiple statements. Atomicity guarantees that each transaction is treated as a single &quot;unit&quot;, which either succeeds completely, or fails completely: if any of the statements constituting a transaction fails to complete, the entire transaction fails and the database is left unchanged. An atomic system must guarantee atomicity in each and every situation, including power failures, errors and crashes.</p></blockquote> <ul><li>Consistency</li></ul> <blockquote><p>Consistency ensures that a transaction can only bring the database from one valid state to another, maintaining database invariants: any data written to the database must be valid according to all defined rules, including constraints, cascades, triggers, and any combination thereof. This prevents database corruption by an illegal transaction, but does not guarantee that a transaction is correct.</p></blockquote> <ul><li>Isolation</li></ul> <blockquote><p>Transactions are often executed concurrently (e.g., reading and writing to multiple tables at the same time). Isolation ensures that concurrent execution of transactions leaves the database in the same state that would have been obtained if the transactions were executed sequentially. Isolation is the main goal of concurrency control; depending on the method used, the effects of an incomplete transaction might not even be visible to other transactions.</p></blockquote> <ul><li>Durability</li></ul> <blockquote><p>Durability guarantees that once a transaction has been committed, it will remain committed even in the case of a system failure (e.g., power outage or crash). This usually means that completed transactions (or their effects) are recorded in non-volatile memory.</p></blockquote> <h2 id="propagation"><a href="#propagation" class="header-anchor">#</a> Propagation</h2> <ul><li>PROPAGATION_REQUIRED</li></ul> <blockquote><p>This attribute tells that the code needs to be run in a transactional context. If a transaction already exists then the code will use it otherwise a new transaction is created. This is the default and mostly widely used transaction setting.</p></blockquote> <ul><li>PROPAGATION_SUPPORTS</li></ul> <blockquote><p>If a transaction exists then the code will use it, but the code does not require a new one. As an example, consider a ticket reservation system. A query to get total seats available can be executed non-transactionally. However, if used within a transaction context it will deduct tickets already selected and reduce them from the total count, and hence may give a better picture. This attribute should be used with care especially when PROPAGATION_REQUIRED or PROPAGATION_REQUIRES_NEW is used within a PROPAGATION_SUPPORTS context.</p></blockquote> <ul><li>PROPAGATION_MANDATORY</li></ul> <blockquote><p>Participates in an existing transaction, however if no transaction context is present then it throws a TransactionRequiredException</p></blockquote> <ul><li>PROPAGATION_REQUIRES_NEW</li></ul> <blockquote><p>Creates a new transaction and if an existing transaction is present then it is suspended. In other words a new transaction is always started. When the new transaction is complete then the original transaction resumes. This transaction type is useful when a sub activity needs to be completed irrespective of the containing transaction. The best example of this is logging. Even if a transaction roll backs you still want to preserve the log statements. Transaction suspension may not work out of the box with all transaction managers, so make sure that the transaction manager supports transaction suspension</p></blockquote> <ul><li>PROPAGATION_NOT_SUPPORTED</li></ul> <blockquote><p>This attribute says that transaction is not supported. In other words the activity needs to be performed non-transactionally. If an existing transaction is present then it is suspended till the activity finishes.</p></blockquote> <ul><li>PROPAGATION_NEVER</li></ul> <blockquote><p>This attributes says that the code cannot be invoked within a transaction. However, unlike PROPAGATION_NOT_SUPPORTED, if an existing transaction is present then an exception will be thrown</p></blockquote> <ul><li>PROPAGATION_NESTED</li></ul> <blockquote><p>The code is executed within a nested transaction if existing transaction is present, if no transaction is present then a new transaction is created. Nested transaction is supported out of the box on only certain transaction managers.</p></blockquote> <h2 id="example"><a href="#example" class="header-anchor">#</a> Example</h2> <p>Here we simulate a stock buying:</p> <p>The Account POJO:</p> <div class="language- extra-class"><pre><code>public class Account {
 
	private int accountid;
	private String name;
	private String balance;
	
	
	public int getAccountid() {
		return accountid;
	}
	public void setAccountid(int accountid) {
		this.accountid = accountid;
	}
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public String getBalance() {
		return balance;
	}
	public void setBalance(String balance) {
		this.balance = balance;
	}
}
</code></pre></div><p>The stock POJO:</p> <div class="language- extra-class"><pre><code>public class Stock {
 
	private int stockid;
	private String name;
	private Integer count;
	
	public Stock() {
		super();
	}
	 
	public Stock(int stockid, String name, Integer count) {
		super();
		this.stockid = stockid;
		this.name = name;
		this.count = count;
	}
 
	public int getStockid() {
		return stockid;
	}
 
	public void setStockid(int stockid) {
		this.stockid = stockid;
	}
 
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public Integer getCount() {
		return count;
	}
	public void setCount(Integer count) {
		this.count = count;
	}
	
}
</code></pre></div><p>AccountDao</p> <div class="language- extra-class"><pre><code>public interface AccountDao {
 
	void addAccount(String name,double money);
	
	void updateAccount(String name,double money,boolean isbuy);
	
}
</code></pre></div><p>Implementation of the AccountDao:</p> <div class="language- extra-class"><pre><code>public class AccountDaoImpl extends JdbcDaoSupport implements AccountDao {
 
	@Override
	public void addAccount(String name, double money) {
		String sql = &quot;insert account(name,balance) values(?,?);&quot;;
		this.getJdbcTemplate().update(sql,name,money);
		
	}
 
	@Override
	public void updateAccount(String name, double money, boolean isbuy) {
		String sql = &quot;update account set balance=balance+? where name=?&quot;;
		if(isbuy)
			sql = &quot;update account set balance=balance-? where name=?&quot;;
		this.getJdbcTemplate().update(sql, money,name);
	}
	
}
</code></pre></div><p>StockDao</p> <div class="language- extra-class"><pre><code>public interface StockDao {
	
	void addStock(String sname,int count);
	
	void updateStock(String sname,int count,boolean isbuy);
 
}
</code></pre></div><p>Implementation of the StockDao:</p> <div class="language- extra-class"><pre><code>public class StockDaoImpl extends JdbcDaoSupport implements StockDao {
 
	@Override
	public void addStock(String sname, int count) {
		String sql = &quot;insert into stock(name,count) values(?,?)&quot;;
		this.getJdbcTemplate().update(sql,sname,count);
	}
 
	@Override
	public void updateStock(String sname, int count, boolean isbuy) {
		String sql = &quot;update stock set count = count-? where name = ?&quot;;
		if(isbuy)
			sql = &quot;update stock set count = count+? where name = ?&quot;;
		this.getJdbcTemplate().update(sql, count,sname);
	}
	
}
</code></pre></div><p>Service interface</p> <div class="language- extra-class"><pre><code>public interface BuyStockService {
 
	public void addAccount(String accountname, double money);
	
	public void addStock(String stockname, int amount);
	
	public void buyStock(String accountname, double money, String stockname, int amount) throws BuyStockException;
	
}
</code></pre></div><p>Implementation of the Service interface:</p> <div class="language- extra-class"><pre><code>public class BuyStockServiceImpl implements BuyStockService{
	
	private AccountDao accountDao;
	private StockDao stockDao;
	
	@Override
	public void addAccount(String accountname, double money) {
		accountDao.addAccount(accountname,money);
	}
 
	@Override
	public void addStock(String stockname, int amount) {
		stockDao.addStock(stockname,amount);
	}
 
	@Override
	public void buyStock(String accountname, double money, String stockname, int amount) throws BuyStockException {
		boolean isBuy = true;
		accountDao.updateAccount(accountname, money, isBuy);
		if(isBuy==true){
			throw new BuyStockException(&quot;error happened when buying stock&quot;);
		}
			stockDao.updateStock(stockname, amount, isBuy);
	}
 
	public AccountDao getAccountDao() {
		return accountDao;
	}
 
	public void setAccountDao(AccountDao accountDao) {
		this.accountDao = accountDao;
	}
 
	public StockDao getStockDao() {
		return stockDao;
	}
 
	public void setStockDao(StockDao stockDao) {
		this.stockDao = stockDao;
	}
	
}
</code></pre></div><p>Costomized exception:</p> <div class="language- extra-class"><pre><code>public class BuyStockException extends Exception {
 
	public BuyStockException() {
		super();
	}
 
	public BuyStockException(String message) {
		super(message);
	}
 
}
</code></pre></div><p>XML for TransactionProxyFactoryBean:</p> <div class="language- extra-class"><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
    xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
    xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
    xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;
    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd
        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.2.xsd
        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-aop-4.2.xsd
        &quot;&gt;
	
	&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;
	
	&lt;bean id=&quot;dataSource&quot; class=&quot;com.kincolle.DataSource&quot;  &gt;
		 &lt;property name=&quot;driverClass&quot; value=&quot;${jdbc.driverClass}&quot;&gt;&lt;/property&gt;
		 &lt;property name=&quot;jdbcUrl&quot;  value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
         &lt;property name=&quot;user&quot;  value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
         &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
	&lt;/bean&gt;
	
	&lt;bean id=&quot;accountDao&quot; class=&quot;com.kincolle.dao.AccountDaoImpl&quot;&gt;
		&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
	&lt;/bean&gt;
	
	&lt;bean id=&quot;stockDao&quot; class=&quot;com.kincolle.dao.StockDaoImpl&quot;&gt;
		&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
	&lt;/bean&gt;
	
	&lt;bean id=&quot;buyStockService&quot; class=&quot;com.kincolle.service.BuyStockServiceImpl&quot;&gt;
		&lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;&gt;&lt;/property&gt;
		&lt;property name=&quot;stockDao&quot; ref=&quot;stockDao&quot;&gt;&lt;/property&gt;
	&lt;/bean&gt;
	
	&lt;bean id=&quot;myTracnsactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
		&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
	&lt;/bean&gt;
	
	&lt;bean id=&quot;serviceProxy&quot; class=&quot;org.springframework.transaction.interceptor.TransactionProxyFactoryBean&quot;&gt;
		&lt;property name=&quot;transactionManager&quot; ref=&quot;myTracnsactionManager&quot;&gt;&lt;/property&gt;
		&lt;property name=&quot;target&quot; ref=&quot;buyStockService&quot;&gt;&lt;/property&gt;
		&lt;property name=&quot;transactionAttributes&quot;&gt;
			&lt;props&gt;
				&lt;prop key=&quot;add*&quot;&gt;ISOLATION_DEFAULT,PROPAGATION_REQUIRED&lt;/prop&gt;
				&lt;prop key=&quot;buyStock&quot;&gt;ISOLATION_DEFAULT,PROPAGATION_REQUIRED,-BuyStockException&lt;/prop&gt;
			&lt;/props&gt;
		&lt;/property&gt;
		
	&lt;/bean&gt;
		
&lt;/beans&gt;  
</code></pre></div><p>Test</p> <div class="language- extra-class"><pre><code>public static void main(String[] args) {
	String resouce = &quot;com/kincolle/applicationContext.xml&quot;;
	ApplicationContext applicationContext = new ClassPathXmlApplicationContext(resouce);
	BuyStockService buyStockService =  (BuyStockService) applicationContext.getBean(&quot;serviceProxy&quot;);		
	try {
		buyStockService.buyStock(&quot;kincolle&quot;, 1000, &quot;ctrip&quot;, 100);
	} catch (BuyStockException e) {
		e.printStackTrace();
	}
}
</code></pre></div><p>Then the transaction will let error happen.</p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/10/2022, 10:47:25 PM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/views/SpringFramework/Spring-SpringFramework-BasicKnowledge-Transaction.html#transaction" class="sidebar-link reco-side-transaction" data-v-cb1513f6>Transaction</a></li><li class="level-2" data-v-cb1513f6><a href="/views/SpringFramework/Spring-SpringFramework-BasicKnowledge-Transaction.html#propagation" class="sidebar-link reco-side-propagation" data-v-cb1513f6>Propagation</a></li><li class="level-2" data-v-cb1513f6><a href="/views/SpringFramework/Spring-SpringFramework-BasicKnowledge-Transaction.html#example" class="sidebar-link reco-side-example" data-v-cb1513f6>Example</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 Asahina Blog
    </div> <div class="operation" style="right:90px;bottom:40px;display:none;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-5775ee02></i></div> <canvas id="banniang" width="200" height="320" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="/bgm/紅蓮華.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="/bgm/紅蓮華.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(/bgm/紅蓮華.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>紅蓮華</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>Lisa</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><div id="goTop" class="hide-cat" data-v-bf92849a></div></div></div>
    <script src="/assets/js/app.7bf124e2.js" defer></script><script src="/assets/js/3.11415aa8.js" defer></script><script src="/assets/js/1.f9d84a83.js" defer></script><script src="/assets/js/126.10227c11.js" defer></script>
  </body>
</html>
