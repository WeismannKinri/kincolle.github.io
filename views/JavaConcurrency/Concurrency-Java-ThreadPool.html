<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ThreadPool | Asahina Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/ok_favicon.ico">
    <meta name="description" content="For Tech Blog">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.167a03c8.css" as="style"><link rel="preload" href="/assets/js/app.7bf124e2.js" as="script"><link rel="preload" href="/assets/js/3.11415aa8.js" as="script"><link rel="preload" href="/assets/js/1.f9d84a83.js" as="script"><link rel="preload" href="/assets/js/92.89ac564f.js" as="script"><link rel="prefetch" href="/assets/js/10.160e6e9c.js"><link rel="prefetch" href="/assets/js/100.3cdef464.js"><link rel="prefetch" href="/assets/js/101.5178591b.js"><link rel="prefetch" href="/assets/js/102.336b2e64.js"><link rel="prefetch" href="/assets/js/103.b749e8f0.js"><link rel="prefetch" href="/assets/js/104.4e0be82d.js"><link rel="prefetch" href="/assets/js/105.2283e32d.js"><link rel="prefetch" href="/assets/js/106.f6d10c35.js"><link rel="prefetch" href="/assets/js/107.168e6177.js"><link rel="prefetch" href="/assets/js/108.8668c986.js"><link rel="prefetch" href="/assets/js/109.6971a03e.js"><link rel="prefetch" href="/assets/js/11.286216e9.js"><link rel="prefetch" href="/assets/js/110.eae35184.js"><link rel="prefetch" href="/assets/js/111.05a11607.js"><link rel="prefetch" href="/assets/js/112.3e67db1b.js"><link rel="prefetch" href="/assets/js/113.89cb826b.js"><link rel="prefetch" href="/assets/js/114.f3d7a768.js"><link rel="prefetch" href="/assets/js/115.63beb6b3.js"><link rel="prefetch" href="/assets/js/116.d3f81a36.js"><link rel="prefetch" href="/assets/js/117.b85ad082.js"><link rel="prefetch" href="/assets/js/118.f1a51aea.js"><link rel="prefetch" href="/assets/js/119.19e0a7b9.js"><link rel="prefetch" href="/assets/js/12.e7c5cbfb.js"><link rel="prefetch" href="/assets/js/120.86fd078a.js"><link rel="prefetch" href="/assets/js/121.007d2594.js"><link rel="prefetch" href="/assets/js/122.f22031f8.js"><link rel="prefetch" href="/assets/js/123.84ca6b69.js"><link rel="prefetch" href="/assets/js/124.3fbddabe.js"><link rel="prefetch" href="/assets/js/125.db4ff77b.js"><link rel="prefetch" href="/assets/js/126.10227c11.js"><link rel="prefetch" href="/assets/js/127.0d7b5084.js"><link rel="prefetch" href="/assets/js/128.1acf472b.js"><link rel="prefetch" href="/assets/js/129.825fe808.js"><link rel="prefetch" href="/assets/js/13.43cc31b1.js"><link rel="prefetch" href="/assets/js/130.0bfc98b2.js"><link rel="prefetch" href="/assets/js/131.aede149c.js"><link rel="prefetch" href="/assets/js/132.85593e8b.js"><link rel="prefetch" href="/assets/js/133.0f271fc3.js"><link rel="prefetch" href="/assets/js/14.0dd24f84.js"><link rel="prefetch" href="/assets/js/15.1b41732d.js"><link rel="prefetch" href="/assets/js/16.183ffc75.js"><link rel="prefetch" href="/assets/js/17.ad9af643.js"><link rel="prefetch" href="/assets/js/18.c13df2c1.js"><link rel="prefetch" href="/assets/js/19.2203e54d.js"><link rel="prefetch" href="/assets/js/20.34db0668.js"><link rel="prefetch" href="/assets/js/21.44a33107.js"><link rel="prefetch" href="/assets/js/22.52d283c5.js"><link rel="prefetch" href="/assets/js/23.4e0524b7.js"><link rel="prefetch" href="/assets/js/24.decf705e.js"><link rel="prefetch" href="/assets/js/25.6873ed81.js"><link rel="prefetch" href="/assets/js/26.4d86aa15.js"><link rel="prefetch" href="/assets/js/27.6b45c11e.js"><link rel="prefetch" href="/assets/js/28.f4d58a14.js"><link rel="prefetch" href="/assets/js/29.871a72fd.js"><link rel="prefetch" href="/assets/js/30.49b4c5ea.js"><link rel="prefetch" href="/assets/js/31.cfc2945d.js"><link rel="prefetch" href="/assets/js/32.343850cd.js"><link rel="prefetch" href="/assets/js/33.0517526c.js"><link rel="prefetch" href="/assets/js/34.85ea8eb4.js"><link rel="prefetch" href="/assets/js/35.43969a65.js"><link rel="prefetch" href="/assets/js/36.7836aa64.js"><link rel="prefetch" href="/assets/js/37.e5812400.js"><link rel="prefetch" href="/assets/js/38.d8d214a6.js"><link rel="prefetch" href="/assets/js/39.f1cb3672.js"><link rel="prefetch" href="/assets/js/4.64515438.js"><link rel="prefetch" href="/assets/js/40.7adf5ab8.js"><link rel="prefetch" href="/assets/js/41.57755578.js"><link rel="prefetch" href="/assets/js/42.38ebc979.js"><link rel="prefetch" href="/assets/js/43.ca6a6476.js"><link rel="prefetch" href="/assets/js/44.41942e77.js"><link rel="prefetch" href="/assets/js/45.41cc929c.js"><link rel="prefetch" href="/assets/js/46.4cbb486f.js"><link rel="prefetch" href="/assets/js/47.ee2cc207.js"><link rel="prefetch" href="/assets/js/48.4397b1ca.js"><link rel="prefetch" href="/assets/js/49.d9aa00a5.js"><link rel="prefetch" href="/assets/js/5.a9ee7173.js"><link rel="prefetch" href="/assets/js/50.b45ed76a.js"><link rel="prefetch" href="/assets/js/51.919d0154.js"><link rel="prefetch" href="/assets/js/52.eb85632f.js"><link rel="prefetch" href="/assets/js/53.3a47197f.js"><link rel="prefetch" href="/assets/js/54.c8d2aed8.js"><link rel="prefetch" href="/assets/js/55.b8b65327.js"><link rel="prefetch" href="/assets/js/56.2d8e9a6e.js"><link rel="prefetch" href="/assets/js/57.38ba175c.js"><link rel="prefetch" href="/assets/js/58.2f7ff696.js"><link rel="prefetch" href="/assets/js/59.56eb125d.js"><link rel="prefetch" href="/assets/js/6.3a661d6d.js"><link rel="prefetch" href="/assets/js/60.197980b0.js"><link rel="prefetch" href="/assets/js/61.4b544728.js"><link rel="prefetch" href="/assets/js/62.b2382e0f.js"><link rel="prefetch" href="/assets/js/63.733bd9cd.js"><link rel="prefetch" href="/assets/js/64.d59be5ac.js"><link rel="prefetch" href="/assets/js/65.9db92d49.js"><link rel="prefetch" href="/assets/js/66.b89a7790.js"><link rel="prefetch" href="/assets/js/67.1353b5b4.js"><link rel="prefetch" href="/assets/js/68.6cf3768b.js"><link rel="prefetch" href="/assets/js/69.5590fae6.js"><link rel="prefetch" href="/assets/js/7.9cb840c5.js"><link rel="prefetch" href="/assets/js/70.2ded2061.js"><link rel="prefetch" href="/assets/js/71.5a572a0a.js"><link rel="prefetch" href="/assets/js/72.4894d369.js"><link rel="prefetch" href="/assets/js/73.c3a7815f.js"><link rel="prefetch" href="/assets/js/74.d1adf6f2.js"><link rel="prefetch" href="/assets/js/75.7e41458b.js"><link rel="prefetch" href="/assets/js/76.686c4022.js"><link rel="prefetch" href="/assets/js/77.835ea7c3.js"><link rel="prefetch" href="/assets/js/78.9ffc54ca.js"><link rel="prefetch" href="/assets/js/79.b6aa2776.js"><link rel="prefetch" href="/assets/js/8.a1c97708.js"><link rel="prefetch" href="/assets/js/80.97d7ee23.js"><link rel="prefetch" href="/assets/js/81.a0a3a3ee.js"><link rel="prefetch" href="/assets/js/82.2290dd53.js"><link rel="prefetch" href="/assets/js/83.0927cd8c.js"><link rel="prefetch" href="/assets/js/84.4d42c930.js"><link rel="prefetch" href="/assets/js/85.f344b6f7.js"><link rel="prefetch" href="/assets/js/86.f7bb8b2b.js"><link rel="prefetch" href="/assets/js/87.7df4d88d.js"><link rel="prefetch" href="/assets/js/88.2b2debf8.js"><link rel="prefetch" href="/assets/js/89.042c73d8.js"><link rel="prefetch" href="/assets/js/9.402194bf.js"><link rel="prefetch" href="/assets/js/90.4d7b430c.js"><link rel="prefetch" href="/assets/js/91.f65d4f6e.js"><link rel="prefetch" href="/assets/js/93.160f3887.js"><link rel="prefetch" href="/assets/js/94.29ed14c3.js"><link rel="prefetch" href="/assets/js/95.4afaed8c.js"><link rel="prefetch" href="/assets/js/96.e8ef314f.js"><link rel="prefetch" href="/assets/js/97.e8db3b68.js"><link rel="prefetch" href="/assets/js/98.540f1fa5.js"><link rel="prefetch" href="/assets/js/99.3a27d21e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.167a03c8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Asahina Blog</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>For Tech Blog</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>Kincolle</span>
            
          <span data-v-25ba6db2>2020 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="Asahina Blog" class="logo"> <span class="site-name">Asahina Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/Design Pattern/" class="nav-link"><i class="undefined"></i>
  Design Pattern
</a></li><li class="dropdown-item"><!----> <a href="/categories/Elasticsearch/" class="nav-link"><i class="undefined"></i>
  Elasticsearch
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hive/" class="nav-link"><i class="undefined"></i>
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Lucene/" class="nav-link"><i class="undefined"></i>
  Lucene
</a></li><li class="dropdown-item"><!----> <a href="/categories/Mybatis/" class="nav-link"><i class="undefined"></i>
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Redis/" class="nav-link"><i class="undefined"></i>
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/kincolle" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  My Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-39576ba9> <h3 class="name" data-v-39576ba9>
    Kincolle
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>123</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>13</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/Design Pattern/" class="nav-link"><i class="undefined"></i>
  Design Pattern
</a></li><li class="dropdown-item"><!----> <a href="/categories/Elasticsearch/" class="nav-link"><i class="undefined"></i>
  Elasticsearch
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hive/" class="nav-link"><i class="undefined"></i>
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Lucene/" class="nav-link"><i class="undefined"></i>
  Lucene
</a></li><li class="dropdown-item"><!----> <a href="/categories/Mybatis/" class="nav-link"><i class="undefined"></i>
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Redis/" class="nav-link"><i class="undefined"></i>
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/kincolle" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  My Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>ThreadPool</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>Kincolle</span>
            
          <span data-v-25ba6db2>2020 - </span>
          2022
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">ThreadPool</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>Kincolle</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>3/19/2018</span></i> <!----> <i class="tags iconfont reco-tag" data-v-f875f3fc><span class="tag-item" data-v-f875f3fc>Java Concurrency</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-reason-of-using-threadpool"><a href="#_1-reason-of-using-threadpool" class="header-anchor">#</a> 1. Reason Of Using ThreadPool</h2> <p>Persuming finish a service needs a runtime that it has: (1)T1:time of creating thread; (2)T2: time of doing task; (3)T3: time of destroying thread. If T1+T3&gt;&gt;&gt;&gt;&gt;T2, then using ThreadPool will enhance performance of service.
So, what is the ThreadPool? The ThreadPool is like a pool of threads, when you want to use a thread then get one from the pool and return the thread back into pool when you finished your task. By this way, there is no runtime of creating thread and destroying thread. That is why it can enhance performance.</p> <h2 id="_2-threadpool-in-java"><a href="#_2-threadpool-in-java" class="header-anchor">#</a> 2. ThreadPool in Java</h2> <p>In java, it provides Executor to implement ThreadPool. Here is a structure of it.
<img src="Concurrency-Java-ThreadPool/1.png" alt=""></p> <p>Interface: Executor, CompletionService, ExecutorService, ScheduledExecutorService<br>
Abstract Class：AbstractExecutorService<br>
Class：ExecutorCompletionService, ThreadPoolExecutor, ScheduledThreadPoolExecutor<br>
From the picture we can see that the most important thing is the ThreadPoolExecutor.</p> <h5 id="threadpoolexecutor"><a href="#threadpoolexecutor" class="header-anchor">#</a> ThreadPoolExecutor</h5> <p>Here is the constructor:</p> <div class="language- extra-class"><pre><code>public class ThreadPoolExecutor extends AbstractExecutorService {
.....
public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,long keepAliveTime,TimeUnit unit,
        BlockingQueue&lt;Runnable&gt; workQueue);

public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,long keepAliveTime,TimeUnit unit,
        BlockingQueue&lt;Runnable&gt; workQueue,ThreadFactory threadFactory);

public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,long keepAliveTime,TimeUnit unit,
        BlockingQueue&lt;Runnable&gt; workQueue,RejectedExecutionHandler handler);

public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,long keepAliveTime,TimeUnit unit,
    BlockingQueue&lt;Runnable&gt; workQueue,ThreadFactory threadFactory,RejectedExecutionHandler handler);
.....
}
</code></pre></div><p>corePoolSize: size of core pool, when pool is created there is no thread. When there are tasks coming then create threads to do tasks. When number of threads equal to corePoolSize, the latter will be put in to queue. That means the corePoolSize is the max size of parallel tasks. If invoke prestartAllCoreThreads(), then the ThreadPool will create all core threads in advance.<br></p> <p>maximumPoolSize: Max size of ThreadPool, it means how many threads can be created. The MaximumPoolSize must &gt;= corePoolSize.<br></p> <p>keepAliveTime: Means how much time thread can be existing without any task. In default, only when number of threads in ThreadPool is larger than corePoolSize, the keepAliveTime will work. In other words, when number of threads in ThreadPool is larger than corePoolSize, and one thread without tasks has been existing for more than keepAliveTime, then shutdown.<br></p> <p>Unit: Unit of keepAliveTime. There are 7 types:</p> <div class="language- extra-class"><pre><code>TimeUnit.DAYS;              
TimeUnit.HOURS;         
TimeUnit.MINUTES;       
TimeUnit.SECONDS;      
TimeUnit.MILLISECONDS;   
TimeUnit.MICROSECONDS;    
TimeUnit.NANOSECONDS;       
</code></pre></div><p>workQueue: It is a blocking queue, used for stored tasks that waiting to be executed. When number of threads in ThreadPool is larger than corePoolSize, threads will be put into block queue to wait. Through workQueue the ThreadPool implements this function.There are 3 types:</p> <div class="language- extra-class"><pre><code>ArrayBlockingQueue;
LinkedBlockingQueue;
SynchronousQueue;
</code></pre></div><p>threadFactory: It is used for creating threads.<br></p> <p>handler: It is the strategy when refuse to execute tasks.<br></p> <h5 id="abstractexecutorservice"><a href="#abstractexecutorservice" class="header-anchor">#</a> AbstractExecutorService</h5> <p>We can see that ThreadPoolExecutor extends AbstractExecutorService, here is the implementation of AbstractExecutorService:</p> <div class="language- extra-class"><pre><code>public abstract class AbstractExecutorService implements ExecutorService {
 
    protected &lt;T&gt; RunnableFuture&lt;T&gt; newTaskFor(Runnable runnable, T value) { };
    protected &lt;T&gt; RunnableFuture&lt;T&gt; newTaskFor(Callable&lt;T&gt; callable) { };
    public Future&lt;?&gt; submit(Runnable task) {};
    public &lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result) { };
    public &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task) { };
    private &lt;T&gt; T doInvokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,
                            boolean timed, long nanos)
        throws InterruptedException, ExecutionException, TimeoutException {
    };
    public &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)
        throws InterruptedException, ExecutionException {
    };
    public &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,
                           long timeout, TimeUnit unit)
        throws InterruptedException, ExecutionException, TimeoutException {
    };
    public &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)
        throws InterruptedException {
    };
    public &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,
                                         long timeout, TimeUnit unit)
        throws InterruptedException {
    };
} 
</code></pre></div><h5 id="executorservice"><a href="#executorservice" class="header-anchor">#</a> ExecutorService</h5> <p>AbstractExecutorService is an abstract class, it implements ExecutorService interface. So let's see the implementation of xecutorService interface:</p> <div class="language- extra-class"><pre><code>public interface ExecutorService extends Executor {
 
    void shutdown();
    boolean isShutdown();
    boolean isTerminated();
    boolean awaitTermination(long timeout, TimeUnit unit)
        throws InterruptedException;
    &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task);
    &lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result);
    Future&lt;?&gt; submit(Runnable task);
    &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)
        throws InterruptedException;
    &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,
                                  long timeout, TimeUnit unit)
        throws InterruptedException;
 
    &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)
        throws InterruptedException, ExecutionException;
    &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,
                    long timeout, TimeUnit unit)
        throws InterruptedException, ExecutionException, TimeoutException;
}
</code></pre></div><h5 id="executor"><a href="#executor" class="header-anchor">#</a> Executor</h5> <p>ExecutorService extends Executor interface, so let's see implementation of Executor:</p> <div class="language- extra-class"><pre><code>public interface Executor {
    void execute(Runnable command);
}
</code></pre></div><h5 id="constructure"><a href="#constructure" class="header-anchor">#</a> Constructure</h5> <p>I think you have understand the relationship of ThreadPoolExecutor, AbstractExecutorService, ExecutorService and Executor.</p> <p>Executor is a top interface and only a function &quot;execute(Runnable)&quot; is in there. The return of the &quot;execute(Runnable)&quot;  is void and its parameter is a Runnable class, which means you will pass a task into it. Then, ExecutorService extends Executor interface and define some functions like: submit, invokeAll, invokeAny and shutDown. AbstractExecutorService implementes ExecutorService interface, it implements all functions of ExecutorService. Then, ThreadPoolExecutor extends AbstractExecutorService.<br></p> <p>In ThreadPoolExecutor, there are some important functions:</p> <div class="language- extra-class"><pre><code>execute()
submit()
shutdown()
shutdownNow()
</code></pre></div><p>The execute() is defined in Executor and implemented in ThreadPoolExecutor. This function is a core function of ThreadPoolExecutor. Through it you can pass a task to let a thread do it. <br>
submit() is defined in ExecutorService and implemented in AbstractExecutorService. It is like &quot;execute()&quot; that it can pass a task too. But the difference is &quot;submit()&quot; can get a return.<br>
The shutdown() and shutdownNow() are yused for closing threads.</p> <h2 id="_3-learning-threadpool-in-detail"><a href="#_3-learning-threadpool-in-detail" class="header-anchor">#</a> 3. Learning ThreadPool in Detail</h2> <h3 id="_3-1-runstate-of-threadpool"><a href="#_3-1-runstate-of-threadpool" class="header-anchor">#</a> 3.1 runState Of ThreadPool</h3> <p>In ThreadPoolExecutor there is a volatile variable and some static final variables represent status of threads:</p> <div class="language- extra-class"><pre><code>volatile int runState;
static final int RUNNING    = 0;
static final int SHUTDOWN   = 1;
static final int STOP       = 2;
static final int TERMINATED = 3;
</code></pre></div><p>The runState is state of the current ThreadPool, it uses volatile to assure the visibiliry. Here is the static final variables:</p> <ul><li>When ThreadPool is created, it is in RUNNING state</li> <li>When invoke shutdown(), it is in SHUTDOWN state. At this time the ThreadPool can not get any new task and will wait on all task having finished.</li> <li>When invoke shutdownNow(), it is in STOP state. At this time the ThreadPool can not get any new task and will try to stop the tasks which is being executed.</li> <li>When the state is SHUTDOWN or STOP, and all working threads has been destroyed, after clear block queue, the state will be TERMINATED.</li></ul> <h3 id="_3-2-task-execution"><a href="#_3-2-task-execution" class="header-anchor">#</a> 3.2 Task Execution</h3> <p>Let's some important variables in ThreadPoolExecutor class</p> <div class="language- extra-class"><pre><code>private final BlockingQueue&lt;Runnable&gt; workQueue;
private final ReentrantLock mainLock = new ReentrantLock();                                                        
private final HashSet&lt;Worker&gt; workers = new HashSet&lt;Worker&gt;();
private volatile long  keepAliveTime;    
private volatile boolean allowCoreThreadTimeOut;  
private volatile int   corePoolSize;  
private volatile int   maximumPoolSize;
private volatile int   poolSize;       
private volatile RejectedExecutionHandler handler; 
private volatile ThreadFactory threadFactory;   
private int largestPoolSize;  
private long completedTaskCount;
</code></pre></div><p>I have introduced corePoolSize, maximumPoolSize, poolSize, workQueue, handler, keepAliveTime and ThreadFactory.</p> <h3 id="_3-3-initial-threadpool"><a href="#_3-3-initial-threadpool" class="header-anchor">#</a> 3.3 Initial ThreadPool</h3> <p>In default, when ThreadPool is created, there is no threads in it until tasks has been put into it. If you want to create threads after creating ThreadPoll immediately, there are 2 functions:</p> <div class="language- extra-class"><pre><code>public boolean prestartCoreThread() {
    return addIfUnderCorePoolSize(null); 
}
 
public int prestartAllCoreThreads() {
    int n = 0;
    while (addIfUnderCorePoolSize(null))
        ++n;
    return n;
}
</code></pre></div><h3 id="_3-4-queue"><a href="#_3-4-queue" class="header-anchor">#</a> 3.4 Queue</h3> <p>I have mentioned queue from time to time, that is workQueue, and it is used for storing tasks that are waiting for being executed. There are 3 types of it:</p> <ul><li>ArrayBlockingQueue: It is based on a first in first out array, this queue must define a size.</li> <li>LinkedBlockingQueue: It is based on a first in first out LinkedList, if you do not define a size, then the size will be Integer.MAX_VALUE.</li> <li>synchronousQueue: This is a special queue that it won't store tasks but create a new thread to do tasks.</li></ul> <h3 id="_3-5-task-rejected-strategy"><a href="#_3-5-task-rejected-strategy" class="header-anchor">#</a> 3.5 Task Rejected Strategy</h3> <p>When the queue is full and the number of threads is maximumPoolSize, then the latter tasks will be refused. Here are the 4 strategies:</p> <div class="language- extra-class"><pre><code>ThreadPoolExecutor.AbortPolicy: Give up this task and throw RejectedExecutionException
ThreadPoolExecutor.DiscardPolicy: Give up this task and do not throw Exception
ThreadPoolExecutor.DiscardOldestPolicy:Give up the task at the frontest queue and do tasks execution again
ThreadPoolExecutor.CallerRunsPolicy: Let the invoking thread do this task
</code></pre></div><h3 id="_3-6-shutdown-of-threadpool"><a href="#_3-6-shutdown-of-threadpool" class="header-anchor">#</a> 3.6 Shutdown of ThreadPool</h3> <p>For shotdown ThreadPool, ThreadPoolExecutor provides 2 functions: shutdown()和shutdownNow(). I have already introduced them.</p> <h3 id="_3-7-volume-of-threadpool"><a href="#_3-7-volume-of-threadpool" class="header-anchor">#</a> 3.7 Volume Of ThreadPool</h3> <p>For changing volume Of ThreadPool, ThreadPoolExecutor provides 2 functions: setCorePoolSize() and setMaximumPoolSize():</p> <ul><li>setCorePoolSize：Set size of CorePool</li> <li>setMaximumPoolSize：Set size of the max mumber of threads</li></ul> <h3 id="demo"><a href="#demo" class="header-anchor">#</a> Demo</h3> <p>Here first is a fundamental demo:</p> <div class="language- extra-class"><pre><code>public class ThreadPoolDemo {
    public static class MyTask implements Runnable{
        @Override
        public void run() {
            System.out.println(System.currentTimeMillis()+&quot;:Thread ID:&quot;+Thread.currentThread().getId());
            try{
                Thread.sleep(1000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }

    public static void main(String[] args) {
        MyTask task = new MyTask();
        ExecutorService es = Executors.newFixedThreadPool(5);
        for(int i =0;i&lt;10;i++){
            es.submit(task);
        }
    }
}
</code></pre></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/10/2022, 10:47:25 PM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/views/JavaConcurrency/Concurrency-Java-ThreadPool.html#_1-reason-of-using-threadpool" class="sidebar-link reco-side-_1-reason-of-using-threadpool" data-v-cb1513f6>1. Reason Of Using ThreadPool</a></li><li class="level-2" data-v-cb1513f6><a href="/views/JavaConcurrency/Concurrency-Java-ThreadPool.html#_2-threadpool-in-java" class="sidebar-link reco-side-_2-threadpool-in-java" data-v-cb1513f6>2. ThreadPool in Java</a></li><li class="level-2" data-v-cb1513f6><a href="/views/JavaConcurrency/Concurrency-Java-ThreadPool.html#_3-learning-threadpool-in-detail" class="sidebar-link reco-side-_3-learning-threadpool-in-detail" data-v-cb1513f6>3. Learning ThreadPool in Detail</a></li><li class="level-3" data-v-cb1513f6><a href="/views/JavaConcurrency/Concurrency-Java-ThreadPool.html#_3-1-runstate-of-threadpool" class="sidebar-link reco-side-_3-1-runstate-of-threadpool" data-v-cb1513f6>3.1 runState Of ThreadPool</a></li><li class="level-3" data-v-cb1513f6><a href="/views/JavaConcurrency/Concurrency-Java-ThreadPool.html#_3-2-task-execution" class="sidebar-link reco-side-_3-2-task-execution" data-v-cb1513f6>3.2 Task Execution</a></li><li class="level-3" data-v-cb1513f6><a href="/views/JavaConcurrency/Concurrency-Java-ThreadPool.html#_3-3-initial-threadpool" class="sidebar-link reco-side-_3-3-initial-threadpool" data-v-cb1513f6>3.3 Initial ThreadPool</a></li><li class="level-3" data-v-cb1513f6><a href="/views/JavaConcurrency/Concurrency-Java-ThreadPool.html#_3-4-queue" class="sidebar-link reco-side-_3-4-queue" data-v-cb1513f6>3.4 Queue</a></li><li class="level-3" data-v-cb1513f6><a href="/views/JavaConcurrency/Concurrency-Java-ThreadPool.html#_3-5-task-rejected-strategy" class="sidebar-link reco-side-_3-5-task-rejected-strategy" data-v-cb1513f6>3.5 Task Rejected Strategy</a></li><li class="level-3" data-v-cb1513f6><a href="/views/JavaConcurrency/Concurrency-Java-ThreadPool.html#_3-6-shutdown-of-threadpool" class="sidebar-link reco-side-_3-6-shutdown-of-threadpool" data-v-cb1513f6>3.6 Shutdown of ThreadPool</a></li><li class="level-3" data-v-cb1513f6><a href="/views/JavaConcurrency/Concurrency-Java-ThreadPool.html#_3-7-volume-of-threadpool" class="sidebar-link reco-side-_3-7-volume-of-threadpool" data-v-cb1513f6>3.7 Volume Of ThreadPool</a></li><li class="level-3" data-v-cb1513f6><a href="/views/JavaConcurrency/Concurrency-Java-ThreadPool.html#demo" class="sidebar-link reco-side-demo" data-v-cb1513f6>Demo</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 Asahina Blog
    </div> <div class="operation" style="right:90px;bottom:40px;display:none;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-5775ee02></i></div> <canvas id="banniang" width="200" height="320" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="/bgm/紅蓮華.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="/bgm/紅蓮華.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(/bgm/紅蓮華.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>紅蓮華</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>Lisa</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><div id="goTop" class="hide-cat" data-v-bf92849a></div></div></div>
    <script src="/assets/js/app.7bf124e2.js" defer></script><script src="/assets/js/3.11415aa8.js" defer></script><script src="/assets/js/1.f9d84a83.js" defer></script><script src="/assets/js/92.89ac564f.js" defer></script>
  </body>
</html>
