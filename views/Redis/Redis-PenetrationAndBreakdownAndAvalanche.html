<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Penetration, breakdown And Avalanche | Asahina Blog</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/ok_favicon.ico">
    <meta name="description" content="For Tech Blog">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.23aadbf3.css" as="style"><link rel="preload" href="/assets/js/app.7ef487d0.js" as="script"><link rel="preload" href="/assets/js/3.9dac7fba.js" as="script"><link rel="preload" href="/assets/js/1.7a264106.js" as="script"><link rel="preload" href="/assets/js/108.909db99b.js" as="script"><link rel="prefetch" href="/assets/js/10.1e68f537.js"><link rel="prefetch" href="/assets/js/100.09e0f01f.js"><link rel="prefetch" href="/assets/js/101.beda3d34.js"><link rel="prefetch" href="/assets/js/102.5640de2b.js"><link rel="prefetch" href="/assets/js/103.4731ba51.js"><link rel="prefetch" href="/assets/js/104.c2a02038.js"><link rel="prefetch" href="/assets/js/105.443c4ad1.js"><link rel="prefetch" href="/assets/js/106.0caa8ffc.js"><link rel="prefetch" href="/assets/js/107.cb0068c6.js"><link rel="prefetch" href="/assets/js/109.dde77e6f.js"><link rel="prefetch" href="/assets/js/11.eb7ce0d8.js"><link rel="prefetch" href="/assets/js/110.3b700db9.js"><link rel="prefetch" href="/assets/js/111.d158c36d.js"><link rel="prefetch" href="/assets/js/112.f8ad71e3.js"><link rel="prefetch" href="/assets/js/113.a3a646bd.js"><link rel="prefetch" href="/assets/js/114.3f9dd18a.js"><link rel="prefetch" href="/assets/js/115.497cc9cb.js"><link rel="prefetch" href="/assets/js/116.21554bd9.js"><link rel="prefetch" href="/assets/js/117.ec9608a8.js"><link rel="prefetch" href="/assets/js/118.1544a8f9.js"><link rel="prefetch" href="/assets/js/119.553a82fa.js"><link rel="prefetch" href="/assets/js/12.98a440dd.js"><link rel="prefetch" href="/assets/js/120.21ca1356.js"><link rel="prefetch" href="/assets/js/121.ee454759.js"><link rel="prefetch" href="/assets/js/122.68de6272.js"><link rel="prefetch" href="/assets/js/123.439c2290.js"><link rel="prefetch" href="/assets/js/124.3b0088be.js"><link rel="prefetch" href="/assets/js/125.6876aa5f.js"><link rel="prefetch" href="/assets/js/126.24035f39.js"><link rel="prefetch" href="/assets/js/127.9f6dbda9.js"><link rel="prefetch" href="/assets/js/128.cd4fc87e.js"><link rel="prefetch" href="/assets/js/129.37b53e36.js"><link rel="prefetch" href="/assets/js/13.c6b94fde.js"><link rel="prefetch" href="/assets/js/130.ee8cbd75.js"><link rel="prefetch" href="/assets/js/131.1ca10788.js"><link rel="prefetch" href="/assets/js/132.4c2581f6.js"><link rel="prefetch" href="/assets/js/133.1752152b.js"><link rel="prefetch" href="/assets/js/14.e6e35416.js"><link rel="prefetch" href="/assets/js/15.1948de1f.js"><link rel="prefetch" href="/assets/js/16.4cfb8e05.js"><link rel="prefetch" href="/assets/js/17.f7720c9b.js"><link rel="prefetch" href="/assets/js/18.bc3ab146.js"><link rel="prefetch" href="/assets/js/19.10222210.js"><link rel="prefetch" href="/assets/js/20.50dfe5d7.js"><link rel="prefetch" href="/assets/js/21.c0e33b4f.js"><link rel="prefetch" href="/assets/js/22.d3517d06.js"><link rel="prefetch" href="/assets/js/23.f337c3f2.js"><link rel="prefetch" href="/assets/js/24.0e0203ac.js"><link rel="prefetch" href="/assets/js/25.32bc7249.js"><link rel="prefetch" href="/assets/js/26.0b66140f.js"><link rel="prefetch" href="/assets/js/27.24f11eba.js"><link rel="prefetch" href="/assets/js/28.ca2c4a72.js"><link rel="prefetch" href="/assets/js/29.63096f46.js"><link rel="prefetch" href="/assets/js/30.68789596.js"><link rel="prefetch" href="/assets/js/31.4260d16f.js"><link rel="prefetch" href="/assets/js/32.1c5a6fd3.js"><link rel="prefetch" href="/assets/js/33.82e68776.js"><link rel="prefetch" href="/assets/js/34.ce4cf983.js"><link rel="prefetch" href="/assets/js/35.ad261254.js"><link rel="prefetch" href="/assets/js/36.eb8c76f3.js"><link rel="prefetch" href="/assets/js/37.81a81246.js"><link rel="prefetch" href="/assets/js/38.8e3fcfb3.js"><link rel="prefetch" href="/assets/js/39.c8f94efb.js"><link rel="prefetch" href="/assets/js/4.fcfb7c5e.js"><link rel="prefetch" href="/assets/js/40.b944e090.js"><link rel="prefetch" href="/assets/js/41.90db94aa.js"><link rel="prefetch" href="/assets/js/42.76bd54a7.js"><link rel="prefetch" href="/assets/js/43.7749b947.js"><link rel="prefetch" href="/assets/js/44.9822e81b.js"><link rel="prefetch" href="/assets/js/45.4aeac282.js"><link rel="prefetch" href="/assets/js/46.5c7b6c79.js"><link rel="prefetch" href="/assets/js/47.e7a84bbd.js"><link rel="prefetch" href="/assets/js/48.1f30a62e.js"><link rel="prefetch" href="/assets/js/49.48309789.js"><link rel="prefetch" href="/assets/js/5.f74ef72c.js"><link rel="prefetch" href="/assets/js/50.bc826004.js"><link rel="prefetch" href="/assets/js/51.f867b65d.js"><link rel="prefetch" href="/assets/js/52.caebe67e.js"><link rel="prefetch" href="/assets/js/53.f3d26e8c.js"><link rel="prefetch" href="/assets/js/54.7fed47bf.js"><link rel="prefetch" href="/assets/js/55.1fe39da3.js"><link rel="prefetch" href="/assets/js/56.1169e824.js"><link rel="prefetch" href="/assets/js/57.6a64b3bc.js"><link rel="prefetch" href="/assets/js/58.d611c032.js"><link rel="prefetch" href="/assets/js/59.e6fdecd7.js"><link rel="prefetch" href="/assets/js/6.2ec60fdb.js"><link rel="prefetch" href="/assets/js/60.e8f1f495.js"><link rel="prefetch" href="/assets/js/61.e2b99f87.js"><link rel="prefetch" href="/assets/js/62.4485a42b.js"><link rel="prefetch" href="/assets/js/63.24f33f9a.js"><link rel="prefetch" href="/assets/js/64.e0bbb783.js"><link rel="prefetch" href="/assets/js/65.32a3cddf.js"><link rel="prefetch" href="/assets/js/66.0e021e40.js"><link rel="prefetch" href="/assets/js/67.18754e17.js"><link rel="prefetch" href="/assets/js/68.75c22faf.js"><link rel="prefetch" href="/assets/js/69.313c670f.js"><link rel="prefetch" href="/assets/js/7.b853e769.js"><link rel="prefetch" href="/assets/js/70.0e54a723.js"><link rel="prefetch" href="/assets/js/71.629cdac8.js"><link rel="prefetch" href="/assets/js/72.81fa76ba.js"><link rel="prefetch" href="/assets/js/73.4d6d17d4.js"><link rel="prefetch" href="/assets/js/74.8ec634a9.js"><link rel="prefetch" href="/assets/js/75.c167c02b.js"><link rel="prefetch" href="/assets/js/76.0b9fdc17.js"><link rel="prefetch" href="/assets/js/77.a34c835f.js"><link rel="prefetch" href="/assets/js/78.9d8c4f3d.js"><link rel="prefetch" href="/assets/js/79.a59895fa.js"><link rel="prefetch" href="/assets/js/8.190e57c9.js"><link rel="prefetch" href="/assets/js/80.d76f6a88.js"><link rel="prefetch" href="/assets/js/81.4db08702.js"><link rel="prefetch" href="/assets/js/82.195ed95f.js"><link rel="prefetch" href="/assets/js/83.d97eedc0.js"><link rel="prefetch" href="/assets/js/84.98b96997.js"><link rel="prefetch" href="/assets/js/85.8f0ecb67.js"><link rel="prefetch" href="/assets/js/86.adc46613.js"><link rel="prefetch" href="/assets/js/87.7d8caaa0.js"><link rel="prefetch" href="/assets/js/88.d135d5ad.js"><link rel="prefetch" href="/assets/js/89.2d400cbb.js"><link rel="prefetch" href="/assets/js/9.a2876319.js"><link rel="prefetch" href="/assets/js/90.6f1c64f3.js"><link rel="prefetch" href="/assets/js/91.a5537604.js"><link rel="prefetch" href="/assets/js/92.7fa23a4f.js"><link rel="prefetch" href="/assets/js/93.a02bee55.js"><link rel="prefetch" href="/assets/js/94.332cfdbd.js"><link rel="prefetch" href="/assets/js/95.cf440115.js"><link rel="prefetch" href="/assets/js/96.08f325b0.js"><link rel="prefetch" href="/assets/js/97.eb0d3af7.js"><link rel="prefetch" href="/assets/js/98.c61f44cb.js"><link rel="prefetch" href="/assets/js/99.594d8d7d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.23aadbf3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-c00e2ab0><div data-v-c00e2ab0><div id="loader-wrapper" class="loading-wrapper" data-v-71fac282 data-v-c00e2ab0 data-v-c00e2ab0><div class="loader-main" data-v-71fac282><div data-v-71fac282></div><div data-v-71fac282></div><div data-v-71fac282></div><div data-v-71fac282></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4a776749 data-v-c00e2ab0 data-v-c00e2ab0><h3 class="title" style="display:none;" data-v-4a776749 data-v-4a776749>Asahina Blog</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-4a776749 data-v-4a776749><input type="password" value="" data-v-4a776749> <span data-v-4a776749>Konck! Knock!</span> <button data-v-4a776749>OK</button></label> <div class="footer" style="display:none;" data-v-4a776749 data-v-4a776749><span data-v-4a776749><i class="iconfont reco-theme" data-v-4a776749></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4a776749>vuePress-theme-reco</a></span> <span data-v-4a776749><i class="iconfont reco-copyright" data-v-4a776749></i> <a data-v-4a776749><span data-v-4a776749>Kincolle</span>
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-c00e2ab0><header class="navbar" data-v-c00e2ab0><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="Asahina Blog" class="logo"> <span class="site-name">Asahina Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/Design Pattern/" class="nav-link"><i class="iconfont undefined"></i>
  Design Pattern
</a></li><li class="dropdown-item"><!----> <a href="/categories/Elasticsearch/" class="nav-link"><i class="iconfont undefined"></i>
  Elasticsearch
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hive/" class="nav-link"><i class="iconfont undefined"></i>
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Lucene/" class="nav-link"><i class="iconfont undefined"></i>
  Lucene
</a></li><li class="dropdown-item"><!----> <a href="/categories/Mybatis/" class="nav-link"><i class="iconfont undefined"></i>
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Redis/" class="nav-link"><i class="iconfont undefined"></i>
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="iconfont undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/kincolle" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  My Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-c00e2ab0></div> <aside class="sidebar" data-v-c00e2ab0><div class="personal-info-wrapper" data-v-1285c3cd><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-1285c3cd> <h3 class="name" data-v-1285c3cd>
    Kincolle
  </h3> <div class="num" data-v-1285c3cd><div data-v-1285c3cd><h3 data-v-1285c3cd>122</h3> <h6 data-v-1285c3cd>Article</h6></div> <div data-v-1285c3cd><h3 data-v-1285c3cd>13</h3> <h6 data-v-1285c3cd>Tag</h6></div></div> <hr data-v-1285c3cd></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/Design Pattern/" class="nav-link"><i class="iconfont undefined"></i>
  Design Pattern
</a></li><li class="dropdown-item"><!----> <a href="/categories/Elasticsearch/" class="nav-link"><i class="iconfont undefined"></i>
  Elasticsearch
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hive/" class="nav-link"><i class="iconfont undefined"></i>
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Lucene/" class="nav-link"><i class="iconfont undefined"></i>
  Lucene
</a></li><li class="dropdown-item"><!----> <a href="/categories/Mybatis/" class="nav-link"><i class="iconfont undefined"></i>
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Redis/" class="nav-link"><i class="iconfont undefined"></i>
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="iconfont undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/kincolle" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  My Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Penetration, breakdown And Avalanche</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/Redis/Redis-PenetrationAndBreakdownAndAvalanche.html#penetration" class="sidebar-link">Penetration</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/Redis/Redis-PenetrationAndBreakdownAndAvalanche.html#breakdown" class="sidebar-link">Breakdown</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/Redis/Redis-PenetrationAndBreakdownAndAvalanche.html#avalanche" class="sidebar-link">Avalanche</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4a776749 data-v-c00e2ab0><h3 class="title" style="display:none;" data-v-4a776749 data-v-4a776749>Penetration, breakdown And Avalanche</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-4a776749 data-v-4a776749><input type="password" value="" data-v-4a776749> <span data-v-4a776749>Konck! Knock!</span> <button data-v-4a776749>OK</button></label> <div class="footer" style="display:none;" data-v-4a776749 data-v-4a776749><span data-v-4a776749><i class="iconfont reco-theme" data-v-4a776749></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4a776749>vuePress-theme-reco</a></span> <span data-v-4a776749><i class="iconfont reco-copyright" data-v-4a776749></i> <a data-v-4a776749><span data-v-4a776749>Kincolle</span>
            
          <!---->
          2020
        </a></span></div></div> <div data-v-c00e2ab0><main class="page"><div class="page-title" style="display:none;"><h1>Penetration, breakdown And Avalanche</h1> <hr> <div data-v-0a86f90e><i class="iconfont reco-account" data-v-0a86f90e><span data-v-0a86f90e>Kincolle</span></i> <i class="iconfont reco-date" data-v-0a86f90e><span data-v-0a86f90e>2018-05-19 20:32:09</span></i> <!----> <i class="iconfont reco-tag tags" data-v-0a86f90e><span class="tag-item" data-v-0a86f90e>
      Redis
    </span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><p>I have read a good article about Penetration, breakdown And Avalanche of cache in <a href="http://www.codeblogbt.com/archives/148143" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Since the birth of the first caching framework Memcached, caching has been widely used in Internet applications. If your application traffic is small, using caching may not require extra consideration. But if your traffic reaches hundreds of millions, you will have to think deeply.Caching problem: cache penetration, cache breakdown and cache avalanche.</p> <h2 id="penetration"><a href="#penetration" class="header-anchor">#</a> Penetration</h2> <p>Cache penetration refers to querying a data that must not exist, because the data does not exist, so it will never be cached, so each request will request the database.</p> <p>For example, we request a user data with UserID as -1, because the user does not exist, so the request reads the database every time. In such a case, if some people who are not in the right way to use this loophole to forge a large number of requests, DB will probably not be able to afford it.So the large amount of traffic is hung up.</p> <p>There are several solutions for cache penetration, one is prevention in advance, and the other is prevention afterwards.</p> <p>Prevention in advance. In fact, all requests are checked by parameter checking, which keeps most illegal requests out of the outermost layer. In our example, we are doing parameter verification, and all requests for UserID less than 0 are rejected. But even if we did a full parameter check,There may be some escape from the net. There will be some unexpected situations.</p> <p>For example, our UserID is increasing, then if someone requests a large user information of a UserID (for example, 1000000), and our UserID is 10000. At this time, you can’t limit UserID’s greater than that.10 thousand is illegal, or more than 100 thousand is illegal, so the user ID can certainly check through parameters. But the user does not exist, so every request will ask the database.</p> <p>In fact, the above is just a situation that I can think of, and there must be a lot of things we didn’t expect. What we can do for these situations is time to prevent.</p> <p>Prevention after the event. After the hindsight, we still cache the empty result when we query an empty result, but set a short expiration time (for one minute, for example). Here we can see that in fact, we did not completely prevent illegal requests, but the risk of illegal requests.Let the redis with stronger capacity to undertake the database with less tolerance will be more secure.</p> <p>Through the above two processing methods, we can basically solve the problem of cache penetration. In advance, 80% illegal requests were prevented and the remaining 20% illegal requests were transferred by Redis.</p> <h2 id="breakdown"><a href="#breakdown" class="header-anchor">#</a> Breakdown</h2> <p>If your application has some hot data with high access, we usually put it in the cache to increase the access speed. In addition, in order to maintain timeliness, we usually set an expiration date. But for these highly visited KEY, we need to consider one problem: when hot KEYAt the moment of failure, does massive requests generate large amounts of database requests, resulting in a database crash?</p> <p>For example, we have a business KEY, which has 10000 concurrent requests for KEY. When the KEY fails, there will be 10 thousand threads requesting the database update cache. Without proper measures at this time, the database is likely to collapse.</p> <p>In fact, the above problem is the problem of cache breakdown, which occurs in the expiration of cache KEY. In this case, there are two commonly used solutions: exclusive locks, never expired.</p> <p>mutex
Mutex refers to when the cache KEY expires to update, let the program get the lock first, only the thread that gets the lock is eligible to update the cache KEY. Other threads that do not get the lock will sleep for a while before getting the latest cache data. In this way, at the same time, there will always be only one.The thread will read the database, thus avoiding the impact of massive database requests on the database.</p> <p>For the locks mentioned above, we can use some of the principles provided by the cache to complete the operation. For example, for redis caching, we can use its SETNX command to complete.</p> <p>public String get(key) {
String value = redis.get(key);
if (value == null) { //Cache expiration
if (redis.setnx(key_mutex, 1, 1 * 60) == 1) {
value = db.get(key);
redis.set(key, value, expireTime);
redis.del(key_mutex);
} else {
//Retry after a few moments of dormancy
sleep(50);
get(key);
}
} else {
return value;
}
}
The key_mutex above is actually an ordinary KEY-VALUE value. We use the setnx command to set its value to 1. If someone updates the cache KEY at this time, the setnx command will return 0, indicating that the settings failed..</p> <p>Never expire
From the point of view of caching, if you set up never to expire, there will be no massive requests for databases. At this time, we usually update the data from the database to the cache by a new way of starting a thread. The more mature way is to synchronize the number of caching and database by the timing task.According to it.</p> <p>But this kind of solution will delay the data, that is, the data read by the thread is not the latest data. But for the general Internet function, a little delay is acceptable.</p> <h2 id="avalanche"><a href="#avalanche" class="header-anchor">#</a> Avalanche</h2> <p>Caching avalanche refers to the same expiration time when we set up the cache, which causes the cache to fail at the same time at the same time. All the requests are forwarded to the database, which eventually leads to the collapse of the transient pressure of the database.</p> <p>For example, we have 1000 KEY, and each KEY has 10 concurrent requests. The cache avalanche refers to the failure of the 1000 KEY at the same time, and then suddenly 1000 * 10 = ten thousand queries..</p> <p>The problems caused by cache avalanche are generally difficult to investigate. If there is no advance prevention, it is likely that it will take a lot of effort to find the cause. For the caching avalanche, the simplest solution is to add a random time (for example, 1-5 minutes) on the basis of the original failure time, so that each cache is overdue.The repetition rate will be reduced, thereby reducing the occurrence of cache avalanche.</p> <p>summary
For the three scenarios of cache penetration, cache breakdown, and buffering avalanche, many people will not understand or even get confused.</p> <p>「Cache penetration refers to data that does not exist, which makes the cache virtually useless, and the cache layer is penetrated. For example, we request a user data with UserID as -1, because the user does not exist, so the request reads the database every time. In this case, if some heartsPeople who are not in the right track to make use of this loophole to forge large numbers of requests are likely to cause DB to not be able to cope with such large traffic and hang up.</p> <p>「”Cache breakdown” refers to KEY with high concurrence. When the KEY fails, there are many requests to request the database at the same time and update the cache. For example, we have a business KEY, which has 10000 concurrent requests for KEY. When the KEY fails, it will beThere are 10 thousand threads that request the database update cache. Without proper measures at this time, the database is likely to collapse.</p> <p>「Cache avalanche means that the cache expires at the same time, just like all snow blocks fall at the same time, like avalanche. For example, we have 1000 KEY, and each KEY has 10 concurrent requests. And the caching avalanche refers to the 1000 KEY failed at the same time, and suddenly there were 1000 * 10 = ten thousand queries.</p> <p>We can make some summaries of their occurrence.</p> <p>「”Cache penetration” is a loophole at the business level resulting in illegal requests, which is not related to the amount of requests and cache invalidation. “Cache breakdown” will only appear on the hot spot data, which is not related to the business at the moment of cache failure. The “cache avalanche” is caused by multiple KEY failures at the same time, resulting in database requests.Too much. Non hot data can also lead to cache avalanche, as long as KEY fails at the same time.</p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">5/6/2020, 6:38:19 PM</span></div></footer> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-1e128e82 data-v-1e128e82><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-1e128e82><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-1e128e82></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-1e128e82></path></svg></div><div class="kanbanniang" data-v-ee8d62e6><div class="banniang-container" style="display:;" data-v-ee8d62e6><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-ee8d62e6>
      欢迎来到 Asahina Blog
    </div> <div class="operation" style="right:90px;bottom:40px;display:none;" data-v-ee8d62e6><i class="kbnfont kbn-ban-home ban-home" data-v-ee8d62e6></i> <i class="kbnfont kbn-ban-message message" data-v-ee8d62e6></i> <i class="kbnfont kbn-ban-close close" data-v-ee8d62e6></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-ee8d62e6><i class="kbnfont kbn-ban-info info" data-v-ee8d62e6></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-ee8d62e6></i></div> <canvas id="banniang" width="200" height="320" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-ee8d62e6></canvas></div> <div class="showBanNiang" style="display:none;" data-v-ee8d62e6>
    看板娘
  </div></div><div class="reco-bgm-panel" data-v-0a2aff30><audio id="bgm" src="/bgm/Saba,Daoud - Where Ideas Sing.mp3" data-v-0a2aff30></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-0a2aff30 data-v-0d264cb4 data-v-0a2aff30><img src="/bgm/1.jpg" data-v-0a2aff30></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-0a2aff30 data-v-0d264cb4 data-v-0a2aff30><div class="reco-bgm-cover" style="background-image:url(/bgm/1.jpg);" data-v-0a2aff30><div class="mini-operation" style="display:none;" data-v-0a2aff30><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-0a2aff30></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-0a2aff30></i></div> <div class="falut-message" style="display:none;" data-v-0a2aff30>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-0a2aff30 data-v-0d264cb4 data-v-0a2aff30><div class="info-box" data-v-0a2aff30><i class="reco-bgm reco-bgm-music music" data-v-0a2aff30></i>Where Ideas Sing</div> <div class="info-box" data-v-0a2aff30><i class="reco-bgm reco-bgm-artist" data-v-0a2aff30></i>Saba,Daoud</div> <div class="reco-bgm-progress" data-v-0a2aff30><div class="progress-bar" data-v-0a2aff30><div class="bar" data-v-0a2aff30></div></div></div> <div class="reco-bgm-operation" data-v-0a2aff30><i class="reco-bgm reco-bgm-last last" data-v-0a2aff30></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-0a2aff30></i> <i class="reco-bgm reco-bgm-play play" data-v-0a2aff30></i> <i class="reco-bgm reco-bgm-next next" data-v-0a2aff30></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-0a2aff30></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-0a2aff30></i> <div class="volume-bar" data-v-0a2aff30><div class="bar" data-v-0a2aff30></div></div></div></div> <div class="reco-bgm-left-box" data-v-0a2aff30 data-v-0d264cb4 data-v-0a2aff30><i class="reco-bgm reco-bgm-left" data-v-0a2aff30></i></div></div></div><div></div><div id="goTop" class="hide-cat" data-v-96c33144></div></div></div>
    <script src="/assets/js/app.7ef487d0.js" defer></script><script src="/assets/js/3.9dac7fba.js" defer></script><script src="/assets/js/1.7a264106.js" defer></script><script src="/assets/js/108.909db99b.js" defer></script>
  </body>
</html>
