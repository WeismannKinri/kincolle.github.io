<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java Collection - TreeMap And TreeSet | Asahina Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/ok_favicon.ico">
    <meta name="description" content="For Tech Blog">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.167a03c8.css" as="style"><link rel="preload" href="/assets/js/app.b9286d3a.js" as="script"><link rel="preload" href="/assets/js/3.34f284b1.js" as="script"><link rel="preload" href="/assets/js/1.f9d84a83.js" as="script"><link rel="preload" href="/assets/js/12.feeaa64e.js" as="script"><link rel="prefetch" href="/assets/js/10.bded442d.js"><link rel="prefetch" href="/assets/js/100.fb4bf34b.js"><link rel="prefetch" href="/assets/js/101.03e7bb16.js"><link rel="prefetch" href="/assets/js/102.4a11ae8b.js"><link rel="prefetch" href="/assets/js/103.5757d761.js"><link rel="prefetch" href="/assets/js/104.be01ea5a.js"><link rel="prefetch" href="/assets/js/105.3e9da9a7.js"><link rel="prefetch" href="/assets/js/106.5c523c0a.js"><link rel="prefetch" href="/assets/js/107.f3ae976c.js"><link rel="prefetch" href="/assets/js/108.3bfc051e.js"><link rel="prefetch" href="/assets/js/109.a950c828.js"><link rel="prefetch" href="/assets/js/11.a30f64dc.js"><link rel="prefetch" href="/assets/js/110.baf94bdd.js"><link rel="prefetch" href="/assets/js/111.d3e82662.js"><link rel="prefetch" href="/assets/js/112.3510c1a5.js"><link rel="prefetch" href="/assets/js/113.490d097d.js"><link rel="prefetch" href="/assets/js/114.86dd7a55.js"><link rel="prefetch" href="/assets/js/115.f9a9de96.js"><link rel="prefetch" href="/assets/js/116.cd589907.js"><link rel="prefetch" href="/assets/js/117.8a557b27.js"><link rel="prefetch" href="/assets/js/118.d7875ce3.js"><link rel="prefetch" href="/assets/js/119.8ec1c8a7.js"><link rel="prefetch" href="/assets/js/120.9cebfd29.js"><link rel="prefetch" href="/assets/js/121.758051b6.js"><link rel="prefetch" href="/assets/js/122.6ca0b73d.js"><link rel="prefetch" href="/assets/js/123.61abedfa.js"><link rel="prefetch" href="/assets/js/124.65c45060.js"><link rel="prefetch" href="/assets/js/125.bee1a935.js"><link rel="prefetch" href="/assets/js/126.7a6ba7c1.js"><link rel="prefetch" href="/assets/js/127.25bd1de5.js"><link rel="prefetch" href="/assets/js/128.5fac26f4.js"><link rel="prefetch" href="/assets/js/129.81fe215a.js"><link rel="prefetch" href="/assets/js/13.a583a50f.js"><link rel="prefetch" href="/assets/js/130.b693c1f7.js"><link rel="prefetch" href="/assets/js/131.c1a5f08f.js"><link rel="prefetch" href="/assets/js/132.c003f99b.js"><link rel="prefetch" href="/assets/js/133.dbc2b1d0.js"><link rel="prefetch" href="/assets/js/134.ffb0ba3e.js"><link rel="prefetch" href="/assets/js/135.2a99648b.js"><link rel="prefetch" href="/assets/js/136.d2485008.js"><link rel="prefetch" href="/assets/js/14.4e745b87.js"><link rel="prefetch" href="/assets/js/15.dbce9029.js"><link rel="prefetch" href="/assets/js/16.38f7e50a.js"><link rel="prefetch" href="/assets/js/17.70925bcd.js"><link rel="prefetch" href="/assets/js/18.e46fb508.js"><link rel="prefetch" href="/assets/js/19.6f29c214.js"><link rel="prefetch" href="/assets/js/20.94a9fcfa.js"><link rel="prefetch" href="/assets/js/21.811a31b4.js"><link rel="prefetch" href="/assets/js/22.9635d013.js"><link rel="prefetch" href="/assets/js/23.d91ca7bb.js"><link rel="prefetch" href="/assets/js/24.7594f22e.js"><link rel="prefetch" href="/assets/js/25.5201c039.js"><link rel="prefetch" href="/assets/js/26.a4a414f5.js"><link rel="prefetch" href="/assets/js/27.b2a25a6f.js"><link rel="prefetch" href="/assets/js/28.6b858d38.js"><link rel="prefetch" href="/assets/js/29.3e3dec62.js"><link rel="prefetch" href="/assets/js/30.f43609d7.js"><link rel="prefetch" href="/assets/js/31.c16f710a.js"><link rel="prefetch" href="/assets/js/32.b832c650.js"><link rel="prefetch" href="/assets/js/33.1d674f70.js"><link rel="prefetch" href="/assets/js/34.eec473cf.js"><link rel="prefetch" href="/assets/js/35.45e677f8.js"><link rel="prefetch" href="/assets/js/36.a94855cd.js"><link rel="prefetch" href="/assets/js/37.d5e360f7.js"><link rel="prefetch" href="/assets/js/38.7adacaec.js"><link rel="prefetch" href="/assets/js/39.a8084e1c.js"><link rel="prefetch" href="/assets/js/4.84e5a624.js"><link rel="prefetch" href="/assets/js/40.33f96378.js"><link rel="prefetch" href="/assets/js/41.5f389133.js"><link rel="prefetch" href="/assets/js/42.2ad3e579.js"><link rel="prefetch" href="/assets/js/43.d050b184.js"><link rel="prefetch" href="/assets/js/44.c471dd41.js"><link rel="prefetch" href="/assets/js/45.97d4b625.js"><link rel="prefetch" href="/assets/js/46.1784fe90.js"><link rel="prefetch" href="/assets/js/47.b9a2f153.js"><link rel="prefetch" href="/assets/js/48.c2c08eb4.js"><link rel="prefetch" href="/assets/js/49.12f675e4.js"><link rel="prefetch" href="/assets/js/5.d5aedfcc.js"><link rel="prefetch" href="/assets/js/50.6cb98f62.js"><link rel="prefetch" href="/assets/js/51.5472efd2.js"><link rel="prefetch" href="/assets/js/52.f84a9f29.js"><link rel="prefetch" href="/assets/js/53.ee8e8ce9.js"><link rel="prefetch" href="/assets/js/54.c9880a25.js"><link rel="prefetch" href="/assets/js/55.16066570.js"><link rel="prefetch" href="/assets/js/56.361cb3ce.js"><link rel="prefetch" href="/assets/js/57.34a0d117.js"><link rel="prefetch" href="/assets/js/58.fadfe4b0.js"><link rel="prefetch" href="/assets/js/59.a41f6a99.js"><link rel="prefetch" href="/assets/js/6.5a7cd716.js"><link rel="prefetch" href="/assets/js/60.192e4257.js"><link rel="prefetch" href="/assets/js/61.f1ce6148.js"><link rel="prefetch" href="/assets/js/62.4106766e.js"><link rel="prefetch" href="/assets/js/63.056f81e0.js"><link rel="prefetch" href="/assets/js/64.5794f88a.js"><link rel="prefetch" href="/assets/js/65.7e27f286.js"><link rel="prefetch" href="/assets/js/66.7f775f7a.js"><link rel="prefetch" href="/assets/js/67.845035a8.js"><link rel="prefetch" href="/assets/js/68.3e950c61.js"><link rel="prefetch" href="/assets/js/69.552f1e2a.js"><link rel="prefetch" href="/assets/js/7.17f7bba3.js"><link rel="prefetch" href="/assets/js/70.58b6c7d7.js"><link rel="prefetch" href="/assets/js/71.ab4857ff.js"><link rel="prefetch" href="/assets/js/72.a2b612a3.js"><link rel="prefetch" href="/assets/js/73.33785b5c.js"><link rel="prefetch" href="/assets/js/74.d0e65e27.js"><link rel="prefetch" href="/assets/js/75.656534c7.js"><link rel="prefetch" href="/assets/js/76.9bf1c8f4.js"><link rel="prefetch" href="/assets/js/77.6fe99cb5.js"><link rel="prefetch" href="/assets/js/78.cde5084e.js"><link rel="prefetch" href="/assets/js/79.c041a32e.js"><link rel="prefetch" href="/assets/js/8.46502f9a.js"><link rel="prefetch" href="/assets/js/80.6bb61012.js"><link rel="prefetch" href="/assets/js/81.833ccf58.js"><link rel="prefetch" href="/assets/js/82.78d0b572.js"><link rel="prefetch" href="/assets/js/83.c349571d.js"><link rel="prefetch" href="/assets/js/84.6031de5e.js"><link rel="prefetch" href="/assets/js/85.977a1325.js"><link rel="prefetch" href="/assets/js/86.398dd26a.js"><link rel="prefetch" href="/assets/js/87.0786c918.js"><link rel="prefetch" href="/assets/js/88.8916a562.js"><link rel="prefetch" href="/assets/js/89.e81a766d.js"><link rel="prefetch" href="/assets/js/9.487070f3.js"><link rel="prefetch" href="/assets/js/90.07201893.js"><link rel="prefetch" href="/assets/js/91.87109b84.js"><link rel="prefetch" href="/assets/js/92.533dd006.js"><link rel="prefetch" href="/assets/js/93.a57472ec.js"><link rel="prefetch" href="/assets/js/94.4cc02a37.js"><link rel="prefetch" href="/assets/js/95.9b69596f.js"><link rel="prefetch" href="/assets/js/96.5e5a6df7.js"><link rel="prefetch" href="/assets/js/97.da7836fe.js"><link rel="prefetch" href="/assets/js/98.4a01baf8.js"><link rel="prefetch" href="/assets/js/99.8d735511.js">
    <link rel="stylesheet" href="/assets/css/0.styles.167a03c8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Asahina Blog</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>For Tech Blog</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>Kincolle</span>
            
          <span data-v-25ba6db2>2020 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="Asahina Blog" class="logo"> <span class="site-name">Asahina Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/Container/" class="nav-link"><i class="undefined"></i>
  Container
</a></li><li class="dropdown-item"><!----> <a href="/categories/Design Pattern/" class="nav-link"><i class="undefined"></i>
  Design Pattern
</a></li><li class="dropdown-item"><!----> <a href="/categories/Elasticsearch/" class="nav-link"><i class="undefined"></i>
  Elasticsearch
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hive/" class="nav-link"><i class="undefined"></i>
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Lucene/" class="nav-link"><i class="undefined"></i>
  Lucene
</a></li><li class="dropdown-item"><!----> <a href="/categories/Message/" class="nav-link"><i class="undefined"></i>
  Message
</a></li><li class="dropdown-item"><!----> <a href="/categories/Mybatis/" class="nav-link"><i class="undefined"></i>
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Redis/" class="nav-link"><i class="undefined"></i>
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/kincolle" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  My Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-39576ba9> <h3 class="name" data-v-39576ba9>
    Kincolle
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>126</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>15</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/Container/" class="nav-link"><i class="undefined"></i>
  Container
</a></li><li class="dropdown-item"><!----> <a href="/categories/Design Pattern/" class="nav-link"><i class="undefined"></i>
  Design Pattern
</a></li><li class="dropdown-item"><!----> <a href="/categories/Elasticsearch/" class="nav-link"><i class="undefined"></i>
  Elasticsearch
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hive/" class="nav-link"><i class="undefined"></i>
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Lucene/" class="nav-link"><i class="undefined"></i>
  Lucene
</a></li><li class="dropdown-item"><!----> <a href="/categories/Message/" class="nav-link"><i class="undefined"></i>
  Message
</a></li><li class="dropdown-item"><!----> <a href="/categories/Mybatis/" class="nav-link"><i class="undefined"></i>
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Redis/" class="nav-link"><i class="undefined"></i>
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/kincolle" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  My Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Java Collection - TreeMap And TreeSet</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>Kincolle</span>
            
          <span data-v-25ba6db2>2020 - </span>
          2022
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">Java Collection - TreeMap And TreeSet</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>Kincolle</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>3/12/2018</span></i> <!----> <i class="tags iconfont reco-tag" data-v-f875f3fc><span class="tag-item" data-v-f875f3fc>Java Collection</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="red-black-tree-and-treemap-and-treeset"><a href="#red-black-tree-and-treemap-and-treeset" class="header-anchor">#</a> Red Black Tree and TreeMap and TreeSet</h1> <h2 id="_1-introduction-of-red-black-tree"><a href="#_1-introduction-of-red-black-tree" class="header-anchor">#</a> 1 Introduction of Red Black Tree</h2> <p>Java TreeMap implements SortedMap interface, that is to say it can sort elements according to key. You can use natural ordering or override a Comparator.<br>
TreeMap is using Red-Black tree, which means the runtime of containsKey(), get(), put() and remove() are log(n).<br> <img src="/assets/img/RBT1.17102e26.png" alt="">
By the way, TreeMap is not thread safe.<br><br>
The Red-Black tree is near to the Binary Search Tree, and it will make sure in any subtree, high of any two nodes will less than two times. In detail, there are some conditions should be satisfied:</p> <ul><li>There are only two kinds of node, red and black.</li> <li>Root node must be black node.</li> <li>Red node can not be continued.(Which means neither father node or child node of a red node should not be a red node)</li> <li>From every node to ant of its null node, the number of black node is the same.</li></ul> <p>When the structure of the tree has been changed(like inserting of deleting), the 3rd or 4th contition will be destroyed, so it need be reconstructed to satisfy all the conditions.</p> <h2 id="_2-some-knowledge-of-red-black-tree"><a href="#_2-some-knowledge-of-red-black-tree" class="header-anchor">#</a> 2 Some Knowledge of Red Black Tree</h2> <h5 id="rotate-left"><a href="#rotate-left" class="header-anchor">#</a> Rotate Left</h5> <p>Rotating left means let right tree of x be father of x. When finish, the conditions of Red Black Tree are still satisfied.
<img src="/assets/img/RBT2.0da993d3.png" alt="">
Here is the source code of rotating left of TreeMap:</p> <div class="language- extra-class"><pre><code>//Rotate Left
private void rotateLeft(Entry&lt;K,V&gt; p) {
    if (p != null) {
        Entry&lt;K,V&gt; r = p.right;
        p.right = r.left;
        if (r.left != null)
            r.left.parent = p;
        r.parent = p.parent;
        if (p.parent == null)
            root = r;
        else if (p.parent.left == p)
            p.parent.left = r;
        else
            p.parent.right = r;
        r.left = p;
        p.parent = r;
    }
}
</code></pre></div><h5 id="rotate-right"><a href="#rotate-right" class="header-anchor">#</a> Rotate Right</h5> <p>Rotating right means let left tree of x be father of x. When finish, the conditions of Red Black Tree are still satisfied.
<img src="/assets/img/RBT3.548fe23e.png" alt="">
Here is the source code of rotating right of TreeMap:</p> <div class="language- extra-class"><pre><code>//Rotate Right
private void rotateRight(Entry&lt;K,V&gt; p) {
    if (p != null) {
        Entry&lt;K,V&gt; l = p.left;
        p.left = l.right;
        if (l.right != null) l.right.parent = p;
        l.parent = p.parent;
        if (p.parent == null)
            root = l;
        else if (p.parent.right == p)
            p.parent.right = l;
        else p.parent.left = l;
        l.right = p;
        p.parent = l;
    }
}
</code></pre></div><h2 id="functions-of-red-black-tree"><a href="#functions-of-red-black-tree" class="header-anchor">#</a> Functions of Red Black Tree</h2> <h5 id="get"><a href="#get" class="header-anchor">#</a> get()</h5> <p>get(Object key) function gets value according to key. This function invokes getEntry(Object key) to get the right entry, and then return &quot;entry.value&quot;. getEntry() is the core of the algorithm. In the algorithm, search elements accoring to order of key, until we find one entry that satisfies &quot;k.compareTo(p.key) == 0&quot;.<br> <img src="/assets/img/RBT4.a94fe143.png" alt="">
The source code is</p> <div class="language- extra-class"><pre><code>//getEntry() function
final Entry&lt;K,V&gt; getEntry(Object key) {
    ......
    if (key == null)//do not allow null key
        throw new NullPointerException();
    Comparable&lt;? super K&gt; k = (Comparable&lt;? super K&gt;) key;//order elements
    Entry&lt;K,V&gt; p = root;
    while (p != null) {
        int cmp = k.compareTo(p.key);
        if (cmp &lt; 0)//go left
            p = p.left;
        else if (cmp &gt; 0)//go right
            p = p.right;
        else
            return p;
    }
    return null;
}
</code></pre></div><h5 id="put"><a href="#put" class="header-anchor">#</a> put()</h5> <p>put(K key, V value) function will put the key-value into a TreeMap. This function will do search for once, if the map has contained the key then replace the value, if not then insert it. Since the inserting may break the structure, so the reconstruction may start.<br>
Here is the source code:</p> <div class="language- extra-class"><pre><code>public V put(K key, V value) {
    ......
    int cmp;
    Entry&lt;K,V&gt; parent;
    if (key == null)
        throw new NullPointerException();
    Comparable&lt;? super K&gt; k = (Comparable&lt;? super K&gt;) key;//order elements
    do {
        parent = t;
        cmp = k.compareTo(t.key);
        if (cmp &lt; 0) t = t.left;//go left
        else if (cmp &gt; 0) t = t.right;//go right
        else return t.setValue(value);
    } while (t != null);
    Entry&lt;K,V&gt; e = new Entry&lt;&gt;(key, value, parent);//create a new entry and insert it
    if (cmp &lt; 0) parent.left = e;
    else parent.right = e;
    fixAfterInsertion(e);//do rotate
    size++;
    return null;
}
</code></pre></div><p>There codes are used to put data and it's easy to understand: First, find the right location to put data. The hard point is &quot;fixAfterInsertion()&quot;, as said before that the reconstruction may start.
<img src="/assets/img/RBT5.24274ac1.png" alt=""></p> <p>fixAfterInsertion() is showed in the following.</p> <div class="language- extra-class"><pre><code>//fixAfterInsertion()
private void fixAfterInsertion(Entry&lt;K,V&gt; x) {
    x.color = RED;
    while (x != null &amp;&amp; x != root &amp;&amp; x.parent.color == RED) {
        if (parentOf(x) == leftOf(parentOf(parentOf(x)))) {
            Entry&lt;K,V&gt; y = rightOf(parentOf(parentOf(x)));
            if (colorOf(y) == RED) {//ify is null, treat it as black
                setColor(parentOf(x), BLACK);              // situation1
                setColor(y, BLACK);                        // situation1
                setColor(parentOf(parentOf(x)), RED);      // situation1
                x = parentOf(parentOf(x));                 // situation1
            } else {
                if (x == rightOf(parentOf(x))) {
                    x = parentOf(x);                       // situation2
                    rotateLeft(x);                         // situation2
                }
                setColor(parentOf(x), BLACK);              // situation3
                setColor(parentOf(parentOf(x)), RED);      // situation3
                rotateRight(parentOf(parentOf(x)));        // situation3
            }
        } else {
            Entry&lt;K,V&gt; y = leftOf(parentOf(parentOf(x)));
            if (colorOf(y) == RED) {
                setColor(parentOf(x), BLACK);              // situation4
                setColor(y, BLACK);                        // situation4
                setColor(parentOf(parentOf(x)), RED);      // situation4
                x = parentOf(parentOf(x));                 // situation4
            } else {
                if (x == leftOf(parentOf(x))) {
                    x = parentOf(x);                       // situation5
                    rotateRight(x);                        // situation5
                }
                setColor(parentOf(x), BLACK);              // situation6
                setColor(parentOf(parentOf(x)), RED);      // situation6
                rotateLeft(parentOf(parentOf(x)));         // situation6
            }
        }
    }
    root.color = BLACK;
}
</code></pre></div><h5 id="successor-node"><a href="#successor-node" class="header-anchor">#</a> successor node</h5> <p>For a binary search tree, get a node t, you can get a successor node by using:</p> <ul><li>right subtree of t is not null, the successor node of t is the smallest one in the right subtree.</li> <li>right subtree of t is null, then successor node of t is the first one which go left among the ancient nodes.</li></ul> <p><img src="/assets/img/RBT6.979ad73e.png" alt=""></p> <p>These will be used in the removing cuntion. Here is the source code:</p> <div class="language- extra-class"><pre><code>// successor() in TreeMap
static &lt;K,V&gt; TreeMap.Entry&lt;K,V&gt; successor(Entry&lt;K,V&gt; t) {
    if (t == null)
        return null;
    else if (t.right != null) {// 1. if right tree of t is not null, then it is the smallest element of this right tree
        Entry&lt;K,V&gt; p = t.right;
        while (p.left != null)
            p = p.left;
        return p;
    } else {// 2. if right child of t is null, then it is first ancient who go left
        Entry&lt;K,V&gt; p = t.parent;
        Entry&lt;K,V&gt; ch = t;
        while (p != null &amp;&amp; ch == p.right) {
            ch = p;
            p = p.parent;
        }
        return p;
    }
}
</code></pre></div><h5 id="remove"><a href="#remove" class="header-anchor">#</a> remove()</h5> <p>Function of remove(Object key) is deleting entry of one key. This function will gey entry by using &quot;getEntry(Object key)&quot;, and the invoke &quot;deleteEntry(Entry&lt;K,V&gt; entry)&quot; to delete one entry. Since this operation may break structure of Red Black Tree, so rotation may happen.<br>
I have described &quot;getEntry()&quot;, now the point is &quot;deleteEntry()&quot;. There are two situations:</p> <ul><li>delete node p and both its left tree and right tree are null or only one not null tree.</li> <li>delete node p and both its left tree and right tree are not null trees.</li></ul> <p>In situation 1, it's easy, just delete p and use not null tree if exists to replace it. In situation 2, you can use successor s of p to replace p then use rule of situation 1 to delete s.</p><hr>
Here is the source code:<p></p> <div class="language- extra-class"><pre><code>	// deleteEntry()
	private void deleteEntry(Entry&lt;K,V&gt; p) {
	    modCount++;
	    size--;
	    if (p.left != null &amp;&amp; p.right != null) {// 2. both left tree and right tree of p are not null trees。
	        Entry&lt;K,V&gt; s = successor(p);// successor
	        p.key = s.key;
	        p.value = s.value;
	        p = s;
	    }
	    Entry&lt;K,V&gt; replacement = (p.left != null ? p.left : p.right);
	    if (replacement != null) {// 1. only one subtree is not null tree
	        replacement.parent = p.parent;
	        if (p.parent == null)
	            root = replacement;
	        else if (p == p.parent.left)
	            p.parent.left  = replacement;
	        else
	            p.parent.right = replacement;
	        p.left = p.right = p.parent = null;
	        if (p.color == BLACK)
	            fixAfterDeletion(replacement);// rotation
	    } else if (p.parent == null) {
	        root = null;
	    } else { // 1. both left tree and right tree of p are null
	        if (p.color == BLACK)
	            fixAfterDeletion(p);// rotation
	        if (p.parent != null) {
	            if (p == p.parent.left)
	                p.parent.left = null;
	            else if (p == p.parent.right)
	                p.parent.right = null;
	            p.parent = null;
	        }
	    }
	}
</code></pre></div><p>In the codes, it's not difficult to understand. Here I will describe about fixAfterDeletion().
<img src="/assets/img/RBT7.2892ab36.png" alt=""></p> <p>In the picture above,:Situation1 turn into situation 2 firstly, or turn into situation 3 or 4. Of course, this picture does not means it must start from situation 1. From the source code we can find that: (1) if it is from 1 to 2, then situation 2 must quit the circle because x is red (2) when come into 3 or 4, it must quit the circle.<br>
Here is the source code:</p> <div class="language- extra-class"><pre><code>private void fixAfterDeletion(Entry&lt;K,V&gt; x) {
    while (x != root &amp;&amp; colorOf(x) == BLACK) {
        if (x == leftOf(parentOf(x))) {
            Entry&lt;K,V&gt; sib = rightOf(parentOf(x));
            if (colorOf(sib) == RED) {
                setColor(sib, BLACK);                   // situation1
                setColor(parentOf(x), RED);             // situation1
                rotateLeft(parentOf(x));                // situation1
                sib = rightOf(parentOf(x));             // situation1
            }
            if (colorOf(leftOf(sib))  == BLACK &amp;&amp;
                colorOf(rightOf(sib)) == BLACK) {
                setColor(sib, RED);                     // situation2
                x = parentOf(x);                        // situation2
            } else {
                if (colorOf(rightOf(sib)) == BLACK) {
                    setColor(leftOf(sib), BLACK);       // situation3
                    setColor(sib, RED);                 // situation3
                    rotateRight(sib);                   // situation3
                    sib = rightOf(parentOf(x));         // situation3
                }
                setColor(sib, colorOf(parentOf(x)));    // situation4
                setColor(parentOf(x), BLACK);           // situation4
                setColor(rightOf(sib), BLACK);          // situation4
                rotateLeft(parentOf(x));                // situation4
                x = root;                               // situation4
            }
        } else { 
            Entry&lt;K,V&gt; sib = leftOf(parentOf(x));
            if (colorOf(sib) == RED) {
                setColor(sib, BLACK);                   // situation5
                setColor(parentOf(x), RED);             // situation5
                rotateRight(parentOf(x));               // situation5
                sib = leftOf(parentOf(x));              // situation5
            }
            if (colorOf(rightOf(sib)) == BLACK &amp;&amp;
                colorOf(leftOf(sib)) == BLACK) {
                setColor(sib, RED);                     // situation6
                x = parentOf(x);                        // situation6
            } else {
                if (colorOf(leftOf(sib)) == BLACK) {
                    setColor(rightOf(sib), BLACK);      // situation7
                    setColor(sib, RED);                 // situation7
                    rotateLeft(sib);                    // situation7
                    sib = leftOf(parentOf(x));          // situation7
                }
                setColor(sib, colorOf(parentOf(x)));    // situation8
                setColor(parentOf(x), BLACK);           // situation8
                setColor(leftOf(sib), BLACK);           // situation8
                rotateRight(parentOf(x));               // situation8
                x = root;                               // situation8
            }
        }
    }
    setColor(x, BLACK);
}
</code></pre></div><h2 id="treeset"><a href="#treeset" class="header-anchor">#</a> TreeSet</h2> <p>TreeSet is based on TreeMap, so if you understand TreeMap, you already understand TreeSet:</p> <div class="language- extra-class"><pre><code>public class TreeSet&lt;E&gt; extends AbstractSet&lt;E&gt;
    implements NavigableSet&lt;E&gt;, Cloneable, java.io.Serializable
{
    ......
    private transient NavigableMap&lt;E,Object&gt; m;
    // Dummy value to associate with an Object in the backing Map
    private static final Object PRESENT = new Object();
    public TreeSet() {
        this.m = new TreeMap&lt;E,Object&gt;();// There is a TreeMap in TreeSet
    }
    ......
    public boolean add(E e) {
        return m.put(e, PRESENT)==null;
    }
    ......
}</code></pre></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/10/2022, 10:47:25 PM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/views/JavaCollection/Java%20Collection-TreeMap.html#_1-introduction-of-red-black-tree" class="sidebar-link reco-side-_1-introduction-of-red-black-tree" data-v-cb1513f6>1 Introduction of Red Black Tree</a></li><li class="level-2" data-v-cb1513f6><a href="/views/JavaCollection/Java%20Collection-TreeMap.html#_2-some-knowledge-of-red-black-tree" class="sidebar-link reco-side-_2-some-knowledge-of-red-black-tree" data-v-cb1513f6>2 Some Knowledge of Red Black Tree</a></li><li class="level-2" data-v-cb1513f6><a href="/views/JavaCollection/Java%20Collection-TreeMap.html#functions-of-red-black-tree" class="sidebar-link reco-side-functions-of-red-black-tree" data-v-cb1513f6>Functions of Red Black Tree</a></li><li class="level-2" data-v-cb1513f6><a href="/views/JavaCollection/Java%20Collection-TreeMap.html#treeset" class="sidebar-link reco-side-treeset" data-v-cb1513f6>TreeSet</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 Asahina Blog
    </div> <div class="operation" style="right:90px;bottom:40px;display:none;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-5775ee02></i></div> <canvas id="banniang" width="200" height="320" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="/bgm/紅蓮華.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="/bgm/紅蓮華.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(/bgm/紅蓮華.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>紅蓮華</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>Lisa</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><div id="goTop" class="hide-cat" data-v-bf92849a></div></div></div>
    <script src="/assets/js/app.b9286d3a.js" defer></script><script src="/assets/js/3.34f284b1.js" defer></script><script src="/assets/js/1.f9d84a83.js" defer></script><script src="/assets/js/12.feeaa64e.js" defer></script>
  </body>
</html>
