(window.webpackJsonp=window.webpackJsonp||[]).push([[121],{845:function(e,t,n){"use strict";n.r(t);var a=n(5),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h2",{attrs:{id:"circular-reference"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#circular-reference"}},[e._v("#")]),e._v(" Circular Reference")]),e._v(" "),n("p",[e._v("In spring, there are 3 kinds of Circular Reference:")]),e._v(" "),n("ol",[n("li",[e._v("Constructor Circular Reference")]),e._v(" "),n("li",[e._v("Setter Circular Reference with singleton scope")]),e._v(" "),n("li",[e._v("Setter Circular Reference with prototype scope")])]),e._v(" "),n("p",[e._v("Here I will introduce them.")]),e._v(" "),n("h3",{attrs:{id:"_1-constructor-circular-reference"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-constructor-circular-reference"}},[e._v("#")]),e._v(" 1. Constructor Circular Reference")]),e._v(" "),n("p",[e._v('In spring container every bean id of creating bean will be put into a "current creating pool". It will be stored in the pool during the creating time. So if you find an id of a bean is in the pool when it is being created, an exception will come out. The BeanCurrentlyInCreationException means Circular Reference. Here let\'s init 3 beans.')]),e._v(" "),n("p",[e._v("StudentA POJO")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("public class StudentA {\n \n    private StudentB studentB ;\n \n    public void setStudentB(StudentB studentB) {\n        this.studentB = studentB;\n    }\n \n    public StudentA() {\n    }\n    \n    public StudentA(StudentB studentB) {\n        this.studentB = studentB;\n    }\n}\n")])])]),n("p",[e._v("StudentB POJO")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("public class StudentB {\n \n    private StudentC studentC ;\n \n    public void setStudentC(StudentC studentC) {\n        this.studentC = studentC;\n    }\n    \n    public StudentB() {\n    }\n \n    public StudentB(StudentC studentC) {\n        this.studentC = studentC;\n    }\n}\n")])])]),n("p",[e._v("StudentC POJO")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("public class StudentC {\n \n    private StudentA studentA ;\n \n    public void setStudentA(StudentA studentA) {\n        this.studentA = studentA;\n    }\n \n    public StudentC() {\n    }\n \n    public StudentC(StudentA studentA) {\n        this.studentA = studentA;\n    }\n}\n")])])]),n("p",[e._v("We can see StudentA depends on StudentB, StudentB depends on StudentC and StudentC depends on StudentA. Definetely there has a Circular Reference. Now let spring init them.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('<bean id="a" class="com.kincolle.StudentA">\n\t<constructor-arg index="0" ref="b"></constructor-arg>\n</bean>\n<bean id="b" class="com.kincolle.StudentB">\n\t<constructor-arg index="0" ref="c"></constructor-arg>\n</bean>\n<bean id="c" class="com.kincolle.StudentC">\n\t<constructor-arg index="0" ref="a"></constructor-arg>\n</bean> \n')])])]),n("p",[e._v("Test class")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('public class Test {\n    public static void main(String[] args) {\n        ApplicationContext context = new ClassPathXmlApplicationContext("com/kincolle/applicationContext.xml");\n    }\n}\n')])])]),n("p",[e._v("The error message will be:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("Caused by: org.springframework.beans.factory.BeanCurrentlyInCreationException: \n\tError creating bean with name 'a': Requested bean is currently in creation: Is there an unresolvable circular reference?\n")])])]),n("h3",{attrs:{id:"_2-setter-circular-reference-with-singleton-scope"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-setter-circular-reference-with-singleton-scope"}},[e._v("#")]),e._v(" 2. Setter Circular Reference with singleton scope")]),e._v(" "),n("p",[e._v("First, let's change the xml to do setter DI with singleton scope:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('<bean id="a" class="com.kincolle.StudentA" scope="singleton">\n\t<property name="studentB" ref="b"></property>\n</bean>\n<bean id="b" class="com.kincolle.StudentB" scope="singleton">\n\t<property name="studentC" ref="c"></property>\n</bean>\n<bean id="c" class="com.kincolle.StudentC" scope="singleton">\n\t<property name="studentA" ref="a"></property>\n</bean>\n')])])]),n("p",[e._v("Test class")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('public class Test {\n    public static void main(String[] args) {\n        ApplicationContext context = new ClassPathXmlApplicationContext("com/kincolle/applicationContext.xml");\n        System.out.println(context.getBean("a", StudentA.class));\n    }\n}\n')])])]),n("p",[e._v("The result is")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("com.kincolle.StudentA@1fbfd6\n")])])]),n("p",[e._v("You may wonder why there is no exception. The answer is:")]),e._v(" "),n("blockquote",[n("p",[e._v("Spring will build a bean instance and will put it into map when it finished, then Spring will get the point to this bean which is not setted any reference. So, when beans of StudentA, StudentB and StudentC has been created successfully, the Circular Reference will get any problem.")])]),e._v(" "),n("p",[e._v("The following is the source code of implementation in DefaultSingletonBeanRegistry.java:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('private final Map<String, Object> singletonObjects = new ConcurrentHashMap<String, Object>(64);\n\nprivate final Map<String, ObjectFactory> singletonFactories = new HashMap<String, ObjectFactory>(16);\n\nprivate final Map<String, Object> earlySingletonObjects = new HashMap<String, Object>(16);\n\nprivate final Set<String> registeredSingletons = new LinkedHashSet<String>(64);\n\nprotected void addSingletonFactory(String beanName, ObjectFactory singletonFactory) {\n\tAssert.notNull(singletonFactory, "Singleton factory must not be null");\n\tsynchronized (this.singletonObjects) {\n\t\tif (!this.singletonObjects.containsKey(beanName)) {\n\t\t\tthis.singletonFactories.put(beanName, singletonFactory);\n\t\t\tthis.earlySingletonObjects.remove(beanName);\n\t\t\tthis.registeredSingletons.add(beanName);\n\t\t}\n\t}\n}\n')])])]),n("h3",{attrs:{id:"_3-setter-circular-reference-with-prototype-scope"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-setter-circular-reference-with-prototype-scope"}},[e._v("#")]),e._v(" 3. Setter Circular Reference with prototype scope")]),e._v(" "),n("p",[e._v("First, let's change the xml to do setter DI with prototype scope:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('<bean id="a" class="com.kincolle.StudentA" scope="prototype">\n\t<property name="studentB" ref="b"></property>\n</bean>\n<bean id="b" class="com.kincolle.StudentB" scope="prototype">\n\t<property name="studentC" ref="c"></property>\n</bean>\n<bean id="c" class="com.kincolle.StudentC" scope="prototype">\n\t<property name="studentA" ref="a"></property>\n</bean>\n')])])]),n("p",[e._v('The scope="prototype" means every request will create a new bean. The most different point is: bean with status uses Prototype  and bean without status uses singleton.')]),e._v(" "),n("p",[e._v("Test class:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('public class Test {\n    public static void main(String[] args) {\n        ApplicationContext context = new ClassPathXmlApplicationContext("com/kincolle/applicationContext.xml");\n        System.out.println(context.getBean("a", StudentA.class));\n    }\n}\n')])])]),n("p",[e._v("The result is:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("Caused by: org.springframework.beans.factory.BeanCurrentlyInCreationException: \n\tError creating bean with name 'a': Requested bean is currently in creation: Is there an unresolvable circular reference?\n")])])]),n("p",[e._v("Why in prototype scope the error occur? Because bean with prototype scope can not be DIed.")])])}),[],!1,null,null,null);t.default=r.exports}}]);