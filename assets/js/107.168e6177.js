(window.webpackJsonp=window.webpackJsonp||[]).push([[107],{817:function(e,t,n){"use strict";n.r(t);var a=n(5),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h2",{attrs:{id:"introduction"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[e._v("#")]),e._v(" Introduction")]),e._v(" "),n("p",[e._v("About statementHandler, no doubt it is the most important thing because it will connect to database. And in here we will use parameterHandler to make our SQL and use ResultHandler to get our result.")]),e._v(" "),n("h2",{attrs:{id:"statementhandler-definition"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#statementhandler-definition"}},[e._v("#")]),e._v(" statementHandler definition")]),e._v(" "),n("p",[e._v("Here let's see the definition of the statementHandler interface")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("public interface StatementHandler {\n \n  Statement prepare(Connection connection)\n      throws SQLException;\n \n  void parameterize(Statement statement)\n      throws SQLException;\n \n  void batch(Statement statement)\n      throws SQLException;\n \n  int update(Statement statement)\n      throws SQLException;\n \n  <E> List<E> query(Statement statement, ResultHandler resultHandler)\n      throws SQLException;\n \n  BoundSql getBoundSql();\n \n  ParameterHandler getParameterHandler();\n \n}\n")])])]),n("p",[e._v("Here are some important method: prepare, parameterize ,query and update")]),e._v(" "),n("p",[e._v("In mybatis there are 4 implementions:")]),e._v(" "),n("ul",[n("li",[e._v("RoutingStatementHandler: It won't have any detail implemention and will build different StatementHandler according to the type of the Executor.")]),e._v(" "),n("li",[e._v("SimpleStatementHandler: It is used for Statement object of JDBC")]),e._v(" "),n("li",[e._v("PreparedStatementHandler: It is used for pretreatment SQL")]),e._v(" "),n("li",[e._v("CallableStatementHandler: It is used for procedure of SQL")])]),e._v(" "),n("p",[e._v('In mybatis, Configuration object will use "new RoutingStatementHandler()" to build StatementHandlerc object. Which means, what we are really using is RoutingStatementHandler object and it will build statementHandler object according to the type of the Executor.')]),e._v(" "),n("p",[e._v("Then we use function of statementHandler to do what we want.")]),e._v(" "),n("h2",{attrs:{id:"prepare-function"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#prepare-function"}},[e._v("#")]),e._v(" prepare function")]),e._v(" "),n("p",[e._v("It is used for compiling SQL. Let's the source code.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v(' @Override\n  public Statement prepare(Connection connection) throws SQLException {\n    ErrorContext.instance().sql(boundSql.getSql());\n    Statement statement = null;\n    try {\n      statement = instantiateStatement(connection);\n      setStatementTimeout(statement);\n      setFetchSize(statement);\n      return statement;\n    } catch (SQLException e) {\n      closeStatement(statement);\n      throw e;\n    } catch (Exception e) {\n      closeStatement(statement);\n      throw new ExecutorException("Error preparing statement.  Cause: " + e, e);\n    }\n  }\n \n  protected abstract Statement instantiateStatement(Connection connection) throws SQLException;\n')])])]),n("p",[e._v("Definitely we concentrate on what does abstract function instantiateStatement do. Since it is an abstract method, it should has an implemetation. Let's see PreparedStatementHandler:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("@Override\n  protected Statement instantiateStatement(Connection connection) throws SQLException {\n    String sql = boundSql.getSql();\n    if (mappedStatement.getKeyGenerator() instanceof Jdbc3KeyGenerator) {\n      String[] keyColumnNames = mappedStatement.getKeyColumns();\n      if (keyColumnNames == null) {\n        return connection.prepareStatement(sql, PreparedStatement.RETURN_GENERATED_KEYS);\n      } else {\n        return connection.prepareStatement(sql, keyColumnNames);\n      }\n    } else if (mappedStatement.getResultSetType() != null) {\n      return connection.prepareStatement(sql, mappedStatement.getResultSetType().getValue(), ResultSet.CONCUR_READ_ONLY);\n    } else {\n      return connection.prepareStatement(sql);\n    }\n  }\n")])])]),n("p",[e._v("It is simple, we can see it is used for compiling SQL.")]),e._v(" "),n("p",[e._v("##parameterize method")]),e._v(" "),n("p",[e._v("When we want to compile SQL, we need to set params and parameterize function of Statement will do it.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("@Override\n  public void parameterize(Statement statement) throws SQLException {\n    parameterHandler.setParameters((PreparedStatement) statement);\n  }\n")])])]),n("p",[e._v("Apparently it implements by parameterHandler.")]),e._v(" "),n("h2",{attrs:{id:"query-update-method"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#query-update-method"}},[e._v("#")]),e._v(" query/update method")]),e._v(" "),n("p",[e._v("After prepare and parameterize, we want operation the SQL we build.There are 2 kinds:")]),e._v(" "),n("ol",[n("li",[e._v("query")]),e._v(" "),n("li",[e._v("update")])]),e._v(" "),n("p",[e._v("Those are simple,let's see the implemetation of  PreparedStatementHandler:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("@Override\n  public int update(Statement statement) throws SQLException {\n    PreparedStatement ps = (PreparedStatement) statement;\n    ps.execute();\n    int rows = ps.getUpdateCount();\n    Object parameterObject = boundSql.getParameterObject();\n    KeyGenerator keyGenerator = mappedStatement.getKeyGenerator();\n    keyGenerator.processAfter(executor, mappedStatement, ps, parameterObject);\n    return rows;\n  }\n \n......\n@Override\n  public <E> List<E> query(Statement statement, ResultHandler resultHandler) throws SQLException {\n    PreparedStatement ps = (PreparedStatement) statement;\n    ps.execute();\n    return resultSetHandler.<E> handleResultSets(ps);\n  }\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);